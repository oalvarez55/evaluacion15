/*1345154404,178142527*/

if (window.CavalryLogger) { CavalryLogger.start_js(["OPEHn"]); }

__d("legacy:fbdesktop-plugin",["FBDesktopPlugin"],function(a,b,c,d){a.FbDesktopPlugin=b('FBDesktopPlugin');},3);
function FriendBrowserCheckboxController(){}copyProperties(FriendBrowserCheckboxController,{instances:{},getInstance:function(a){return this.instances[a];}});copyProperties(FriendBrowserCheckboxController.prototype,{init:function(a,b){FriendBrowserCheckboxController.instances[a]=this;this._id=a;this._form=b;this._contentGrid=DOM.find(b,'.friendBrowserCheckboxContentGrid');this._loadingIndicator=DOM.find(b,'.friendBrowsingCheckboxContentLoadingIndicator');this._checkboxResults=DOM.find(b,'.friendBrowserCheckboxResults');this._contentPager=DOM.find(b,'.friendBrowserCheckboxContentPager');this.numGetNewRequests=0;this.queuedRequests={};},addTypeahead:function(a,b){a.subscribe('select',this.onHubSelect.bind(this,a,b));},onHubSelect:function(a,b,event,c){if(!((event=='select')&&c.selected))return;var d=this.buildNewCheckbox(b,c.selected.text,c.selected.uid),e=DOM.find(this._form,'.checkboxes_'+b);DOM.appendContent(e.firstChild,d);var f=DOM.scry(a.getElement(),'input[type="button"]');if(f&&f[0])f[0].click();this.getNew(true);},buildNewCheckbox:function(a,b,c){var d=a+'_ids_'+c,e=a+'_ids[]',f=DOM.create('input',{id:d,type:'checkbox',value:c,name:e,checked:true});Event.listen(f,'click',bind(this,'getNew',false));var g=DOM.create('td',null,f);CSS.addClass(g,'vTop');CSS.addClass(g,'hLeft');var h=DOM.create('label',null,b),i=DOM.create('td',null,h);CSS.addClass(i,'vMid');CSS.addClass(i,'hLeft');var j=DOM.create('tr');j.appendChild(g);j.appendChild(i);return j;},showMore:function(){var a=DOM.scry(this._contentPager,'.friendBrowserMorePager')[0];if(!a)return false;if(CSS.hasClass(a,'async_saving'))return false;var b=this.numGetNewRequests,c=Form.serialize(this._form);c.show_more=true;var d=new AsyncRequest().setURI('/ajax/growth/friend_browser/checkbox.php').setData(c).setHandler(bind(this,function(e){this.showMoreHandler(e,b);})).setStatusElement(a).send();},showMoreHandler:function(a,b){if(b==this.numGetNewRequests){var c=a.payload;DOM.appendContent(this._contentGrid,c.results);this.updatePagerAndExtraData(c.pager,c.extra_data);}},getNew:function(a){this.numGetNewRequests++;var b=this.numGetNewRequests;CSS.addClass(this._checkboxResults,'friendBrowserCheckboxContentOnload');if(ge('friendBrowserCI'))CSS.addClass($('friendBrowserCI'),'friendBrowserCheckboxContentOnload');CSS.show(this._loadingIndicator);var c=Form.serialize(this._form);c.used_typeahead=a;new AsyncRequest().setURI('/ajax/growth/friend_browser/checkbox.php').setData(c).setHandler(bind(this,function(d){this.getNewHandler(d,b);})).send();},getNewHandler:function(a,b){if(b==this.numGetNewRequests){var c=a.payload;DOM.setContent(this._contentGrid,c.results);CSS.removeClass(this._checkboxResults,'friendBrowserCheckboxContentOnload');if(ge('friendBrowserCI'))CSS.hide($('friendBrowserCI'));CSS.hide(this._loadingIndicator);this.updatePagerAndExtraData(c.pager,c.extra_data);}},updatePagerAndExtraData:function(a,b){DOM.setContent(this._contentPager,a);this.setupOnVisible();DOM.replace(this._form.elements.extra_data,b);},setupOnVisible:function(){var a=DOM.scry(this._contentPager,'.friendBrowserMorePager')[0];if(a&&this._id!='jewel'){this._onVisible&&this._onVisible.remove();this._onVisible=new OnVisible(a,bind(this,'showMore'),false,1000);}}});
__d("legacy:ScrollableArea",["ScrollableArea"],function(a,b,c,d){a.ScrollableArea=b('ScrollableArea');},3);
function RequestsJewel(){}copyProperties(RequestsJewel.prototype,{init:function(a,b,c){this.countNew=0;this.jewel=a;this.jewelFlyoutCase=a.getRoot();this.jewelFlyout=ge('fbRequestsFlyout');this.newCountSpan=ge('newRequestCount');this.folder=b;this.doNewMarkRead=c;this._requestList={};this._requestCount=0;var d=ge('requestsMarkReadButton');if(d)Event.listen(d,'click',this._markRead.shield(this));this.jewel.subscribe('marked-seen',this._markSeenCallback.shield(this));this.jewel.subscribe('closed',this._clearNewItems.shield(this));this.jewel.subscribe('updated',this._updateCount.bind(this));this.jewel.subscribe('opened',this._openHandler.bind(this));LinkController.registerHandler(this._handleLink.bind(this));Arbiter.subscribe(ChannelConstants.getArbiterType('jewel_requests_add'),this._addRequest.bind(this));Arbiter.subscribe(ChannelConstants.getArbiterType('jewel_requests_remove_old'),this._removeOldRequest.bind(this));Event.listen(this.jewelFlyout,'submit',function(f){var g=Parent.byClass(f.getTarget(),'objectListItem');if(g){CSS.removeClass(g,'jewelItemNew');CSS.addClass(g,'jewelItemResponded');}}.bind(this));var e=DOM.scry(this.jewelFlyout,'.uiScrollableAreaWrap')[0];if(e){this._scrollableWrap=e;this._lastLinkPosition=0;this._scrollListener=Event.listen(e,'scroll',this._handleScroll.bind(this),Event.Priority._BUBBLE);}return this;},fromDom:function(){DOM.scry(this.jewelFlyout,'.jewelItemList li.objectListItem').forEach(function(a){var b=a.getAttribute('id'),c=b&&parseInt(this._parseID(b).requester,10);if(c&&!isNaN(c)){this._requestList[c]=b;++this._requestCount;}}.bind(this));this._conditionShowEmptyMessage();},_parseID:function(a){var b=a.match(/^(\d+)_(\d+)/);return (b)?{requester:b[1],type:b[2]}:undefined;},_handleLink:function(a,event){var b=Parent.byClass(a,'jewelItemNew');if(b&&Parent.byClass(b,'fbRequestList')&&Parent.byClass(b,'beeperEnabled')){var c=this._parseID(b.id);c&&this._markSeenCallback(c.requester,c.type);Arbiter.inform('jewel/count-updated',{jewel:'requests',count:--this.countNew});CSS.removeClass(b,'jewelItemNew');}return true;},_handleScroll:function(){var a=DOM.scry(this._scrollableWrap,'.uiMorePager')[0];if(a){var b=Vector2.getElementPosition(a,'viewport').y;if(b>0)CSS.addClass(Parent.byClass(this._scrollableWrap,'uiScrollableArea'),'contentAfter');var c=DOM.find(a,'a');if(!c)return;var d=Vector2.getElementPosition(c,'viewport').y;if(d==this._lastLinkPosition)return;var e=Vector2.getElementPosition(this._scrollableWrap,'viewport').y+Vector2.getElementDimensions(this._scrollableWrap).y;if(d-300<e&&d>0){this._lastLinkPosition=d;var f=c.getAttribute('ajaxify');if(f){new AsyncRequest(f).setRelativeTo(c).setStatusElement(Parent.byClass(c,'stat_elem')).send();}else FriendBrowserCheckboxController.getInstance('jewel').showMore();}}},_addRequest:function(a,b){if(!b||this._requestList[b.obj.from])return;var c=DOM.scry(this.jewelFlyout,'.fbRequestList .uiList')[0];if(!c)return;DOM.prependContent(c,b.obj.markup);var d=DOM.scry(this.jewelFlyout,'#fbRequestsPYMKContainer')[0];if(!d){var e=DOM.find(ge(b.obj.itemid),'form'),f=DOM.create('input',{type:'hidden',name:'num_visible_requests',value:this._requestCount+1});DOM.appendContent(e,f);}var g={jewel:'requests',count:++this.countNew};Arbiter.inform('jewel/count-updated',g);this._requestList[b.obj.from]=b.obj.itemid;++this._requestCount;this._conditionShowEmptyMessage();},_removeOldRequest:function(a,b){if(!b)return;var c=this._requestList[b.obj.from],d=c&&ge(c);if(d){CSS.hasClass(d,'jewelItemNew')&&Arbiter.inform('jewel/count-updated',{jewel:'requests',count:--this.countNew});if(!CSS.hasClass(d,'jewelItemResponded')){DOM.remove(d);delete this._requestList[c];--this._requestCount;this._conditionShowEmptyMessage();}}},_markRead:function(){this.jewel.markSeen();this._clearNewItems();},_markSeenCallback:function(a,b){new AsyncSignal('/ajax/gigaboxx/endpoint/UpdateLastSeenTime.php',{folder:this.folder}).send();var c=typeof a!='undefined'&&typeof b!='undefined'?{requester:a,type:b}:{};this.doNewMarkRead&&new AsyncSignal('/ajax/requests/mark_read/',c).send();},_removeRequest:function(a,b){var c=b.obj.item_id;if(c){var d=ge(c),e=d&&CSS.hasClass(d,'jewelItemNew');d?DOM.remove(d):false;e&&Arbiter.inform('jewel/count-updated',{jewel:'requests',count:--this.countNew});}},_clearNewItems:function(a,b){DOM.scry(this.jewel.root,'li.jewelItemNew').forEach(function(c){CSS.removeClass(c,'jewelItemNew');});},_updateCount:function(a,b){this.countNew=b.count;CSS.conditionClass(this.jewelFlyout,'beeperUnread',this.countNew>0);CSS.conditionClass(this.jewelFlyoutCase,'showRequests',this.countNew>0);if(this.newCountSpan){var c=this.countNew==1?tx._("{num} NUEVA SOLICITUD",{num:this.countNew}):tx._("{num} SOLICITUDES NUEVAS",{num:this.countNew});DOM.setContent(this.newCountSpan,c);}},_conditionShowEmptyMessage:function(){DOM.scry(this.jewelFlyout,'li.empty').forEach(function(a){CSS.conditionShow(a,this._requestCount<=0);}.bind(this));},_openHandler:function(){var a=DOM.scry(this.jewelFlyout,'.uiScrollableArea')[0];a&&ScrollableArea.poke(a);}});
__d("ContextualBlind",["event-extensions","Animation","DOM","Rect","Vector","$"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Animation'),h=b('DOM'),i=b('Rect'),j=b('Vector'),k=b('$'),l=[],m=null,n=null,o=false,p=.8,q=500;function r(u,v){v.getPositionVector().setElementPosition(u);v.getDimensionVector().setElementDimensions(u);}function s(){l=[];m&&m.remove();n&&h.remove(n);o=false;}var t={show:function(u,v,w){t.hide();for(var x=0;x<4;x++)l.push(h.create('div',{className:'contextualBlind'}));h.appendContent(document.body,l);if(w!==false){n=h.create('div',{className:'contextualBlindContext'});h.appendContent(document.body,n);}t.updatePosition(u,v);m=Event.listen(window,'resize',t.updatePosition.bind(t,u,v));o=true;},fadeIn:function(u,v,w,x,y){var z=o;t.show(u,v,w);if(z)return;p=x!==undefined?x:p;q=y!==undefined?y:q;for(var aa=0;aa<l.length;aa++){var ba=l[aa];new g(ba).duration(q).from('opacity',0).to('opacity',p).go();}},hide:function(){l.forEach(h.remove);s();},fadeOut:function(){for(var u=0;u<l.length;u++){var v=l[u];new g(v).duration(q).from('opacity',p).to('opacity',0).ondone(h.remove.curry(v)).go();}s();},updatePosition:function(u,v){var w=j.getDocumentDimensions().y,x=i.getElementBounds(k(u));if(v)x=new i(x.t-v,x.r+v,x.b+v,x.l-v,x.domain);var y=document,z=(y&&y.documentElement&&y.documentElement.clientWidth)||(y&&y.body&&y.body.clientWidth)||0;r(l[0],new i(0,z,x.t,0,'document'));r(l[1],new i(x.t,z,x.b,x.r,'document'));r(l[2],new i(x.b,z,w,0,'document'));r(l[3],new i(x.t,x.l,x.b,0,'document'));if(n)r(n,x);}};e.exports=a.ContextualBlind||t;});
__d("JewelX",["event-extensions","Arbiter","ArbiterMixin","Class","ContextualBlind","CSS","DOM","HTML","Keys","Toggler","copyProperties","reportData"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('Class'),j=b('ContextualBlind'),k=b('CSS'),l=b('DOM'),m=b('HTML'),n=b('Keys'),o=b('Toggler'),p=b('copyProperties'),q=b('reportData'),r=function(s,t){s&&t&&this.init(s,t);};p(r,{_instancesByName:{},_resizeListener:null});p(r.prototype,h,{init:function(s,t){this.name=t.name;this.root=s;this.countNew=0;this.initialCount=0;this.escHandler=null;this.fadeOnOpen=t.fade_on_open;r._instancesByName[this.name]=this;o.listen('show',this.root,function(u){this._logFirstClick();this.hasNew()&&this.markSeen();this.reset();this.inform('opened');g.inform('layer_shown',{type:'Jewel'});this.setupEvents();this.fadeOnOpen&&j.fadeIn(this.root,0,true,.7,100);}.bind(this));o.listen('hide',this.root,function(u,v){this.hasNew()&&this.markSeen();this.reset();this.inform('closed');g.inform('layer_hidden',{type:'Jewel'});this.removeEvents();if(this.fadeOnOpen&&(!v||!v.clickedTarget||!k.hasClass(v.clickedTarget,'jewelButton')||l.contains(this.root,v.clickedTarget)))j.fadeOut();}.bind(this));g.subscribe('jewel/count-updated',function(u,v){v.jewel==this.name&&this.update(v);}.bind(this));g.subscribe('jewel/count-initial',function(u,v){v.jewel==this.name&&this.setInitial(v);}.bind(this));g.subscribe('jewel/reset',function(u,v){v.jewel==this.name&&this.reset();}.bind(this));r._resizeListener=r._resizeListener||(function(){var u=null;return Event.listen(window,'resize',function(){clearTimeout(u);u=g.inform.bind(g,'jewel/resize').defer(100,false);});})();},getRoot:function(){return this.root;},hasNew:function(){return k.hasClass(this.root,'hasNew');},isOpen:function(){return k.hasClass(this.root,'openToggler');},reset:function(){k.removeClass(this.root,'hasNew');},setContent:function(s){var t=l.find(this.root,'ul.jewelItemList');l.setContent(t,m(s));},update:function(s){this.countNew=s.count;var t=l.find(this.root,'span.jewelCount span');l.setContent(t,this.countNew);var u=isNaN(this.countNew)||this.countNew>0;k.conditionClass(this.root,'hasNew',u);this.inform('updated',s);},setInitial:function(s){this.initialCount=s;},setupEvents:function(){this.escHandler=Event.listen(document.documentElement,'keydown',function(s){if(s.keyCode===n.ESC&&this.isOpen())o.hide(this.root);}.bind(this));},removeEvents:function(){if(this.escHandler)this.escHandler.remove();},markSeen:function(){g.inform('jewel/count-updated',{jewel:this.name,count:0},g.BEHAVIOR_STATE);this.inform('marked-seen');},_logFirstClick:function(){this._logFirstClick=bagofholding;q('jewel_click',{gt:{count:this.countNew,initial:this.initialCount,jewel:this.name}});}});e.exports=r;});
__d("UserNoOp",["copyProperties"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=function(){},i=function(){return this;};g(h.prototype,{add_event:i,add_data:i,set_ua_id:i,set_namespace:i});e.exports=h;});
__d("legacy:UserAction",["UserNoOp","userAction"],function(a,b,c,d){a.UserNoOp=b('UserNoOp');a.user_action=b('userAction');a.report_data=function(e,f){user_action(e,null,null,'FORCE',f);};},3);
__d("legacy:DocumentTitle",["DocumentTitle"],function(a,b,c,d){a.DocumentTitle=b('DocumentTitle');},3);
__d("legacy:Poller",["Poller"],function(a,b,c,d){a.Poller=b('Poller');},3);
__d("deferUntil",[],function(a,b,c,d,e,f){function g(h,i,j,k,l){var m=i();if(m){h(m);return null;}var n=Date.now(),o=setInterval(function(){m=i();if(!m){if(!j||(j<new Date()-n))return;l&&l();}clearInterval(o);h(m);},20,k);return o;}e.exports=g;});
__d("legacy:function-utils",["debounce","throttle","deferUntil"],function(a,b,c,d){a.debounce=b('debounce');a.throttle=b('throttle');a.defer_until=b('deferUntil');},3);
__d("legacy:user-activity",["UserActivity"],function(a,b,c,d){a.UserActivity=a.UserActivity||b('UserActivity');},3);
__d("BanzaiODS",["BanzaiDesktop"],function(a,b,c,d,e,f){var g=b('BanzaiDesktop'),h={};function i(k,l,m,n){var o=h[k]||(h[k]={});o=o[l]||(o[l]={});o=o[m]||(o[m]=[]);for(var p=0;p<n.length;p++){var q=n[p]==null?1:Number(n[p]);if(isFinite(q))o[p]=(o[p]||0)+q;}}g.subscribe(g.SEND,function(){for(var k in h){g.post('ods',h);break;}h={};});var j={bumpEntityKey:function(k,l,m){i('bEK',k,l,[m]);},bumpFraction:function(k,l,m,n){i('bF',k,l,[m,n]);}};e.exports=j;});
__d("OptionStorage",["copyProperties"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=window.localStorage||null;function i(j,k,l){this.name=j;this.reviver=k||this._reviver;this.replacer=l||this._replacer;this._read();}g(i.prototype,{_read:function(j,k){if(h&&h[this.name]){this.options=JSON.parse(h[this.name],this.reviver);}else this.options={};},_write:function(){if(h){var j=g({},this.options);h[this.name]=JSON.stringify(j,this.replacer);}},_reviver:function(j,k){if(k){var l=/^\[RegExp (.*)\]$/.test(k)&&RegExp.$1;if(l)k=new RegExp(l.replace(/^\/|\/$/g,''));return k;}},_replacer:function(j,k){if(k instanceof RegExp){k='[RegExp '+k+']';this[j]=k;}return k;},get:function(j,k){return j in this.options?this.options[j]:k;},set:function(j,k){if(k==null){delete this.options[j];}else this.options[j]=k;this._write();}});e.exports=i;});
__d("MegaphoneHelper",["Animation","AsyncRequest","Dialog","ge"],function(a,b,c,d,e,f){var g=b('Animation'),h=b('AsyncRequest'),i=b('Dialog'),j=b('ge'),k={hideStory:function(l,m,n,o,p){var q={mp_id:l,location:m,context:o};new h().setURI('/ajax/megaphone/megaphone_hide.php').setMethod('POST').setData(q).setHandler(function(s){p&&p(s);}).send();var r=j(n);if(r)g(r).to('height',0).duration(500).hide().go();},createModalStory:function(l,m,n,o){var p;if(!l.buttons||!l.buttons.length){l.buttons=i.CLOSE;p=this.hideStory.bind(this,m,n,o,null);}var q=new i(l);if(p)q.setHandler(p);q.show();},buttonOnClick:function(l,m,n,o,p,q){var r=function(){if(p){new h().setURI(o).send();}else document.location.href=o;};if(q){this.hideStory(l,m,'',n,function(){r();});}else r();}};e.exports=k;});
__d("legacy:megaphone",["MegaphoneHelper"],function(a,b,c,d){a.MegaphoneHelper=b('MegaphoneHelper');},3);
__d("MessagingEvents",["array-extensions","Arbiter","ChannelConstants","copyProperties","isEmpty"],function(a,b,c,d,e,f){b('array-extensions');var g=b('Arbiter'),h=b('ChannelConstants'),i=b('copyProperties'),j=b('isEmpty'),k={},l=new g();function m(n){if(!j(k))return;for(var o in n)l.inform('count/'+o,n[o]);}l.subscribe('mark-as-read',function(n,o){(o.tids||o.chat_ids||[]).forEach(function(p){p=''+p;if(!(p in k)){k[p]=true;var q=function(){l.unsubscribe(r);clearTimeout(s);delete k[p];},r=l.subscribe('read',function(t,u){if((u.tids||[]).contains(p)||(u.chat_ids||[]).contains(p))q();}),s=q.defer(60000);}});});g.subscribe(h.getArbiterType('messaging'),function(n,o){var p=i({},o.obj),event=p.event||'';delete p.type;delete p.event;l.inform(event,p);if('unread_counts' in p){var q=p.unread_counts;m({unread:q.inbox,other_unseen:q.other});}});g.subscribe(h.getArbiterType('inbox'),function(n,o){var p=i(o.obj);delete p.type;m(p);});a.MessagingEvents=e.exports=l;},3);
__d("DoublyLinkedListMap",["copyProperties"],function(a,b,c,d,e,f){var g=b('copyProperties');function h(){this._head=null;this._tail=null;this._nodes={};this._nodeCount=0;}g(h.prototype,{get:function(i){return this._nodes[i]?this._nodes[i].data:null;},_insert:function(i,j,k,l){k&&!this._nodes[k]&&(k=null);var m=(k&&this._nodes[k])||(l?this._head:this._tail),n={data:j,key:i,next:null,prev:null};if(m){this.remove(i);if(l){n.prev=m.prev;m.prev&&(m.prev.next=n);m.prev=n;n.next=m;}else{n.next=m.next;m.next&&(m.next.prev=n);m.next=n;n.prev=m;}}n.prev===null&&(this._head=n);n.next===null&&(this._tail=n);this._nodes[i]=n;this._nodeCount++;return this;},insertBefore:function(i,j,k){return this._insert(i,j,k,true);},insertAfter:function(i,j,k){return this._insert(i,j,k,false);},prepend:function(i,j){return this.insertBefore(i,j,this._head&&this._head.key);},append:function(i,j){return this.insertAfter(i,j,this._tail&&this._tail.key);},remove:function(i){var j=this._nodes[i];if(j){var k=j.next,l=j.prev;k&&(k.prev=l);l&&(l.next=k);this._head===j&&(this._head=k);this._tail===j&&(this._tail=l);delete this._nodes[i];this._nodeCount--;}return this;},find:function(i){for(var j=this._head;j;j=j.next)if(i(j.data))return j.key;return null;},reduce:function(i,j){for(var k=this._head;k;k=k.next)j=i(k.data,j);return j;},exists:function(i){return !!this._nodes[i];},isEmpty:function(){return !this._head;},reset:function(){this._head=null;this._tail=null;this._nodes={};this._nodeCount=0;},map:function(i){for(var j=this._head;j;j=j.next)i(j.data);},getCount:function(){return this._nodeCount;},getHead:function(){return this._head.data;},getTail:function(){return this._tail.data;},getNext:function(i){var j=this._nodes[i];if(j&&j.next)return j.next.data;return null;},getPrev:function(i){var j=this._nodes[i];if(j&&j.prev)return j.prev.data;return null;}});e.exports=h;});
__d("Quickling",["AjaxPipeRequest","Arbiter","Class","DocumentTitle","DOM","HTML","OnloadHooks","PageTransitions","Run","URI","UserAgent","copyProperties","goOrReplace","isEmpty","QuicklingConfig"],function(a,b,c,d,e,f){var g=b('AjaxPipeRequest'),h=b('Arbiter'),i=b('Class'),j=b('DocumentTitle'),k=b('DOM'),l=b('HTML'),m=b('OnloadHooks'),n=b('PageTransitions'),o=b('Run'),p=b('URI'),q=b('UserAgent'),r=b('copyProperties'),s=b('goOrReplace'),t=b('isEmpty'),u=c('QuicklingConfig'),v=u.version,w=u.sessionLength,x=new RegExp(u.inactivePageRegex),y=0,z,aa='',ba=[],ca={isActive:function(){return true;},isPageActive:function(ka){if(ka=='#')return false;ka=new p(ka);if(ka.getDomain()&&ka.getDomain()!=p().getDomain())return false;if(ka.getPath()=='/l.php'){var la=ka.getQueryData().u;if(la){la=p(unescape(la)).getDomain();if(la&&la!=p().getDomain())return false;}}var ma=ka.getPath(),na=ka.getQueryData();if(!t(na))ma+='?'+p.implodeQuery(na);return !x.test(ma);},addURIQueryAugmenter:function(ka){ba.push(ka);}};function da(ka){ka=ka||'Facebook';j.set(ka);if(q.ie()){aa=ka;if(!z)z=window.setInterval(function(){var la=aa,ma=j.get();if(la!=ma)j.set(la);},5000,false);}}function ea(ka){var la=document.getElementsByTagName('link');for(var ma=0;ma<la.length;++ma){if(la[ma].rel!='alternate')continue;k.remove(la[ma]);}if(ka.length){var na=k.find(document,'head');na&&k.appendContent(na,l(ka[0]));}}function fa(ka){var la={version:v};this.parent.construct(this,ka,{quickling:la});}i.extend(fa,g);r(fa.prototype,{_preBootloadFirstResponse:function(ka){return true;},_fireDomContentCallback:function(){this._request.cavalry&&this._request.cavalry.setTimeStamp('t_domcontent');n.transitionComplete();this._onPageDisplayed&&this._onPageDisplayed(this.pipe);this.parent._fireDomContentCallback();},_fireOnloadCallback:function(){if(this._request.cavalry){this._request.cavalry.setTimeStamp('t_hooks');this._request.cavalry.setTimeStamp('t_layout');this._request.cavalry.setTimeStamp('t_onload');}this.parent._fireOnloadCallback();},isPageActive:function(ka){return ca.isPageActive(ka);},_versionCheck:function(ka){if(ka.version==v)return true;var la=['quickling','ajaxpipe','ajaxpipe_token'];s(window.location,p(ka.uri).removeQueryData(la),true);return false;},_processFirstResponse:function(ka){var la=ka.getPayload();da(la.title);ea(la.syndication||[]);window.scrollTo(0,0);var ma=la.body_class||'';document.body.className=ma;},getSanitizedParameters:function(){return ['quickling'];}});function ga(ka){var la=[],ma=p(ka);ba.forEach(function(na){var oa=na(ma);if(!oa)return;la.push(na);ma=ma.addQueryData(oa);});ba=la;return ma;}function ha(){y++;return y>=w;}function ia(ka){g.setCurrentRequest(null);if(ha())return false;ka=ga(ka);if(!ca.isPageActive(ka))return false;window.ExitTime=Date.now();o.__removeHook('onafterloadhooks');o.__removeHook('onloadhooks');m.runHooks('onleavehooks');h.inform('onload/exit',true);new fa(ka).setCanvasId('content').send();return true;}function ja(ka){window[ka+'_native']=(function(la){return function ma(na,oa){return la(na,oa);};})(window[ka]);window[ka]=function la(ma,na,oa){var pa=window[ka+'_native'](ma,na);if(na>0)if(oa!==false)o.onLeave(function(){clearInterval(pa);});return pa;};}ja('setInterval');ja('setTimeout');n.registerHandler(ia,1);e.exports=a.Quickling=ca;});
__d("MusicButtonStore",[],function(a,b,c,d,e,f){var g={},h={addButton:function(i,j){g[i]=j;return j;},getButton:function(i){return g[i];},getButtons:function(){return g;},removeButton:function(i){g[i]&&g[i].resetLoadingTimers();delete g[i];}};e.exports=h;});
__d("MusicEvents",["Arbiter"],function(a,b,c,d,e,f){var g=b('Arbiter');e.exports=a.MusicEvents=new g();});
__d("MusicProviders",[],function(a,b,c,d,e,f){e.exports=a.MusicProviders={SPOTIFY:'open.spotify.com'};});
__d("MusicConstants",["Arbiter","MusicEvents","MusicProviders"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('MusicEvents'),i=b('MusicProviders'),j={DEBUG:false,LIVE_LISTEN_MIN_SPOTIFY_VERSION:'spotify-0.6.6.0.g5a9eaca5',enableDebug:function(){this.DEBUG=true;},sameURLs:function(k,l){var m=/\/$/;if(k&&l){k=URI(k);l=URI(l);return k.getDomain()==l.getDomain()&&k.getPath()==l.getPath();}return false;},greaterOrEqualToMinimumVersion:function(k,l){var m=/(?:\d+\.)+/,n=k.match(m)[0].split('.').slice(0,-1),o=l.match(m)[0].split('.').slice(0,-1);if(n.length!==o.length)return false;for(var p=0;p<o.length;p++)if(+n[p]<+o[p]){return false;}else if(+n[p]>+o[p])return true;return true;},sanitizeForProviders:function(k){var l={};for(var m in k)if(this.ALLOWED_EXTERNAL_CONTEXT_PARAMS[m])l[m]=k[m];return l;},OP:{RESUME:'RESUME',PAUSE:'PAUSE',PLAY:'PLAY',VERSION:'VERSION'},STATUS_CHANGE_OP:{STATUS:'STATUS',LOGIN:'LOGIN',REINFORM:'REINFORM'},STATUS_CHANGE_EVENT:{playing:'PLAY_STATE_CHANGED',track:'TRACK_CHANGED'},DIAGNOSTIC_EVENT:{ALL_PAUSED:'ALL_PAUSED',ALL_OFFLINE:'ALL_OFFLINE',OFFLINE:'OFFLINE',ONLINE:'ONLINE',SEARCHING:'SEARCHING',HIT:'HIT',MISS:'MISS',RESIGN:'RESIGN',IFRAME_POLLING:'IFRAME_POLLING',RELAUNCH:'RELAUNCH',STATE_CHANGE:'STATE_CHANGE',WRONG_VERSION:'WRONG_VERSION',SERVICE_ERROR:'SERVICE_ERROR',INCORRECT_ONLINE_STATE:'INCORRECT_ONLINE_STATE',LOG_SEND_OP:'LOG_SEND_OP',REQUEUE_OP:'REQUEUE_OP'},ALLOWED_STATUS_PARAMS:{playing:'playing',track:'track',context:'context',client_version:'client_version',start_time:'start_time',expires_in:'expires_in',open_graph_state:'open_graph_state'},ALLOWED_EXTERNAL_CONTEXT_PARAMS:{uri:true,song:true,radio_station:true,album:true,playlist:true,musician:true,song_list:true,offset:true,title:true,request_id:true,listen_with_friends:true,needs_tos:true},LIVE_LISTEN_OP:{NOW_LEADING:'NOW_LEADING',NOW_LISTENING:'NOW_LISTENING',END_SESSION:'END_SESSION',SONG_PLAYING:'SONG_PLAYING',LISTENER_UPDATE:'LISTENER_UPDATE',QUEUE_SESSION:'QUEUE_SESSION',PLAY_ERROR:'PLAY_ERROR',SESSION_UPDATED:'SESSION_UPDATED',QUEUING_SESSION:'QUEUING_SESSION'},MUSIC_BUTTON:{ACTIVATE:'ACTIVATE'},ERROR:{1:'SERVICE_UNAVAILABLE_WITHOUT_PREMIUM',2:'SERVICE_UNAVAILABLE_WITHOUT_PREMIUM_OR_WAIT',3:'SERVICE_UNAVAILABLE_BILLING_ISSUE',4:'SERVICE_UNAVAILABLE_TECHNICAL_ISSUE',5:'AUDIO_AD_PLAYING',99:'SERVICE_TEMPORARILY_UNAVAILABLE',101:'SONG_UNAVAILABLE_WITHOUT_PURCHASE',102:'SONG_UNAVAILABLE_WITHOUT_PREMIUM',103:'SONG_UNAVAILABLE_INDEFINITELY'}};e.exports=a.MusicConstants||j;});
__d("MusicWaterfallLogger",["JSLogger"],function(a,b,c,d,e,f){var g=b('JSLogger'),h=g.create('music_waterfall'),i={click:function(l){j('click',l);},musicLoadedFromClick:function(l){j('music_loaded_from_click',l);},playPause:function(l){j('play_pause',l);}};function j(l,m){h.debug(l+'_debug',m);h.bump(l);h.bump(l+'_'+k(m));}function k(l){return l?l.replace(/\.|-/g,'_'):'';}e.exports=i;});
__d("MusicButton",["Bootloader","copyProperties","CSS","DOM","MusicButtonStore","MusicConstants","MusicEvents","MusicWaterfallLogger","Parent","Tooltip"],function(a,b,c,d,e,f){var g=b('Bootloader'),h=b('copyProperties'),i=b('CSS'),j=b('DOM'),k=b('MusicButtonStore'),l=b('MusicConstants'),m=b('MusicEvents'),n=b('MusicWaterfallLogger'),o=b('Parent'),p=b('Tooltip'),q=function(r,s,t,u,v,w){this.provider=r;this.buttonElem=s;this.url=t;this.context=u||{};this.mediaType=v;this.setState(this.STATES.OFFLINE);this.tooltip=w||'';m.subscribe(l.MUSIC_BUTTON.ACTIVATE,this.processClick.bind(this));};h(q,{tracksetableTypes:[]});h(q.prototype,{SHOW_LOADING_TIMEOUT:500,HIDE_LOADING_TIMEOUT:4000,RECENTLY_ONLINE_TIMEOUT:6000,STATES:{PLAYING:'music_playing',PAUSED:'music_paused',LOADING:'music_loading',DISABLED:'music_disabled',OFFLINE:'music_offline'},setState:function(r){if(r!==this.STATES.LOADING){this.resetLoadingTimers();this.previousState=this.state||r;}if(r===this.STATES.PLAYING){p.set(this.buttonElem,this.tooltip);}else p.set(this.buttonElem,'');var s=this.buttonElem.parentNode;this.state&&i.removeClass(s,this.state);this.state=r;i.addClass(s,this.state);},isTracksetable:function(r){return q.tracksetableTypes.indexOf(this.mediaType)!==-1;},handleIncomingEvent:function(r,s){clearTimeout(this._showLoadingTimer);if(s&&s.provider&&s.provider!=this.provider)return;switch(r){case l.DIAGNOSTIC_EVENT.ONLINE:case l.STATUS_CHANGE_EVENT.track:case l.STATUS_CHANGE_EVENT.playing:var t=s&&s.track&&s.track.uri,u=s&&s.context&&s.context.uri;if(s&&s.playing&&(l.sameURLs(t,this.url)||l.sameURLs(u,this.url))){this.setState(this.STATES.PLAYING);}else if(this.state===this.STATES.LOADING&&(this.previousState===this.STATES.PAUSED||this.previousState===this.STATES.OFFLINE)){clearTimeout(this._attemptingPlayTimer);this._attemptingPlayTimer=this.setState.bind(this,this.STATES.PAUSED).defer(this.RECENTLY_ONLINE_TIMEOUT,false);}else if(!this._attemptingPlayTimer)this.setState(this.STATES.PAUSED);break;case l.DIAGNOSTIC_EVENT.OFFLINE:this.setState(this.STATES.OFFLINE);break;case l.DIAGNOSTIC_EVENT.ALL_OFFLINE:this.setState(this.STATES.OFFLINE);break;}},processClick:function(r,s){if(s!=this.buttonElem){if(this.state===this.STATES.LOADING)this.previousState&&this.setState(this.previousState);return;}n.click(this.provider);var t=this.isTracksetable()&&o.byClass(this.buttonElem,'music_trackset_container'),u=[];if(t){var v=t.getAttribute('data-trackset-title'),w=this.provider,x=j.scry(t,'.music_button');for(var y=0;y<x.length;y++){var z=k.getButton([x[y].id]);if(z&&z.provider==w&&z.isTracksetable())u.push(z.url);}}if(!a.Music)this.showLoading(true);g.loadModules(['Music'],function(aa){n.musicLoadedFromClick(this.provider);var ba=(t&&u.length>1)?aa.playPauseSongList(this.provider,this.url,u,v,this.context):aa.playPauseSong(this.provider,this.url,this.context);this.showLoading(!ba);}.bind(this));},showLoading:function(r){this.resetLoadingTimers();this._hideLoadingTimer=this._timeout.bind(this,r).defer(this.HIDE_LOADING_TIMEOUT,false);this._showLoadingTimer=this.setState.bind(this,this.STATES.LOADING).defer(this.SHOW_LOADING_TIMEOUT,false);},resetLoadingTimers:function(){clearTimeout(this._hideLoadingTimer);clearTimeout(this._showLoadingTimer);clearTimeout(this._attemptingPlayTimer);this._attemptingPlayTimer=null;},destroy:function(){this.resetLoadingTimers();this.buttonElem=null;},_timeout:function(r){a.Music&&a.Music.reInform([this.provider]);if(!r&&this.state===this.STATES.LOADING)this.setState(this.STATES.PAUSED);}});e.exports=q;});
__d("MusicButtonManager",["DOM","KeyedCallbackManager","Layer","MusicButton","MusicButtonStore","MusicConstants","MusicEvents","Parent","event-extensions","$","copyProperties","ge"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('KeyedCallbackManager'),i=b('Layer'),j=b('MusicButton'),k=b('MusicButtonStore'),l=b('MusicConstants'),m=b('MusicEvents'),n=b('Parent');b('event-extensions');var o=b('$'),p=b('event-extensions').$E,q=b('copyProperties'),r=b('ge'),s=new h(),t=null,u={},v=0;function w(event){var da=p(event).getTarget(),ea=n.byClass(da,'music_button');ea=ea||(!event.getModifiers().any&&x(da));if(!ea)return;return y(ea,event);}function x(da){var ea=n.byClass(da,'music_button_trigger')&&n.byClass(da,'music_button_trigger_group');if(ea){var fa=g.scry(ea,'.music_button');if(fa.length)return fa[0];}return null;}function y(da,event){event&&p(event).stop();m.inform(l.MUSIC_BUTTON.ACTIVATE,da);return false;}function z(da){a.Music&&a.Music.reInform(da);}function aa(da,ea){var fa=k.getButtons();for(var ga in fa)if(fa[ga].noGC||r(ga)){fa[ga].handleIncomingEvent(da,ea);}else k.removeButton(ga);}var ba={init:function(da){if(t)return;t=true;j.tracksetableTypes=da||[];Event.listen(document.body,'click',w);m.subscribe([l.STATUS_CHANGE_EVENT.playing,l.STATUS_CHANGE_EVENT.track,l.DIAGNOSTIC_EVENT.OFFLINE,l.DIAGNOSTIC_EVENT.ALL_OFFLINE,l.DIAGNOSTIC_EVENT.ONLINE],aa);},add:function(da,ea,fa,ga,ha,ia){t||ba.init();var ja=ea.id,ka=k.getButton(ja);if(ka)return ka;ka=k.addButton(ja,new j(da,ea,fa,q({button_id:ja},ga),ha,ia));var la=n.byClass(ea,'uiOverlay');if(la){ka.noGC=true;var ma=i.subscribe('destroy',function(na,oa){if(g.contains(oa.getRoot(),ea)){k.removeButton(ja);i.unsubscribe(ma);}});}if(da&&!u[da])u[da]=function(){var na=Object.keys(u);na.length&&z(na);u={};}.defer();return ka;},addButton:function(da,ea,fa,ga,ha,ia){if(!r(ea))return;var ja=o(ea);return ba.add(da,ja,fa,ga,ha,ia);},asyncAddMusicButton:function(da,ea){da.setAttribute('id','music_button_'+v++);ca(da,ea);},tryAddButtonInDOM:function(da,ea){var fa=r(da);fa&&ca(fa,ea);},addMusicData:function(da,ea,fa,ga,ha,ia){s.setResource(da,{provider:ea,uri:fa,context:ga,media_type:ha,tooltip:ia});}};function ca(da,ea){var fa=g.find(da,'a.button_anchor').getAttribute('href');s.executeOrEnqueue(fa,function(ga){return ba.add(ga.provider,da,ga.uri,ga.context,ga.media_type,ea?ga.tooltip:'');});}e.exports=a.MusicButtonManager||ba;});
__d("NotificationCounter",["Arbiter","DocumentTitle","JSLogger"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('DocumentTitle'),i=b('JSLogger'),j={messages:0,notifications:0,requests:0},k={init:function(){g.subscribe('update_title',this._handleUpdate.bind(this));g.subscribe('jewel/count-updated',this._handleCountUpdate.bind(this));},getCount:function(){var l=0;for(var m in j){var n=Number(j[m]);if(typeof j[m]=='string'&&isNaN(n))return j[m];if(isNaN(n)||n<0){i.create('jewels').error('bad_count',{jewel:m,count:j[m]});continue;}l+=n;}return l;},updateTitle:function(){var l=this.getCount(),m=h.get();m=l?'('+l+') '+m:m;h.set(m,true);},_handleCountUpdate:function(l,m){j[m.jewel]=m.count;this.updateTitle();},_handleUpdate:function(l,m){this.updateTitle();}};e.exports=k;});
__d("legacy:notifications-counter",["NotificationCounter"],function(a,b,c,d){a.NotificationCounter=b('NotificationCounter');},3);
__d("NotificationSound",["Sound","ChatOptions","copyProperties"],function(a,b,c,d,e,f){var g=b('Sound'),h=b('ChatOptions'),i=b('copyProperties');g.init(['audio/mpeg']);function j(k){this._soundPath=k;}i(j.prototype,{play:function(){if(this._soundPath!==null&&h.getSetting('sound'))g.play(this._soundPath);}});e.exports=j;});
__d("legacy:notifications-sound",["NotificationSound"],function(a,b,c,d){a.NotificationSound=b('NotificationSound');},3);
__d("legacy:notif-xlist",["NotifXList"],function(a,b,c,d){a.NotifXList=b('NotifXList');},3);
function NegativeNotif(a,b){copyProperties(this,b);this.owner=a;this.xLink=DOM.find(this.obj,'.notif_x');this.confirmingMsg=DOM.find(this.obj,'.confirmingMsg');this.mainLink=DOM.find(this.obj,'.notifMainLink');this.userXClicked=false;this.userUnsubscribed=false;Event.listen(this.xLink,'click',this.xClick.bind(this));if(CSS.hasClass(this.obj,'first_receipt')&&CSS.hasClass($('jewelContainer'),'notifGentleAppReceipt')){this.gentleFirstReceiptHoverEventHandler=Event.listen(this.obj,'mouseover',this.gentleFirstReceiptNotifHover.bind(this));this.clone_notif=this.obj.cloneNode(true);CSS.addClass(this.clone_notif,'clone_notif');}}copyProperties(NegativeNotif.prototype,{FADE_AWAY_DURATION:2500,X_OUT_DURATION:100,X_OUT_DURATION_SHORT:2,GENTLE_FRUI_MIN_HOVER_DURATION:500,xClick:function(event){this._activateX();var a=this.xLink.getAttribute('data-gt'),b=a?{gt:JSON.parse(a)}:{};user_action('click',this.xLink,event,null,b);return false;},gentleFirstReceiptNotifHover:function(event){event.stop();var a=DOM.find(this.obj,'.first_receipt_no_button'),b=a.getAttribute('title');Tooltip.set(a,b,'above','center');Tooltip.show(a);if(!this.gentleFirstReceiptUnhoverEventHandler){this.hoverTime=new Date();this.gentleFirstReceiptUnhoverEventHandler=Event.listen(document.documentElement,'mouseover',this.gentleFirstReceiptNotifUnhover.bind(this));}if(!this.gentleFirstReceiptNoClickEventHandler)this.gentleFirstReceiptNoClickEventHandler=Event.listen(a,'click',this.gentleFirstReceiptNoClick.bind(this));},gentleFirstReceiptNotifUnhover:function(event){if(Parent.byClass(event.getTarget(),'uiContextualLayer')||Parent.byClass(event.getTarget(),'uiScrollableAreaTrack'))return false;var a=new Date();if(this.hoverTime&&a-this.hoverTime<this.GENTLE_FRUI_MIN_HOVER_DURATION){this.gentleFirstReceiptUnhoverEventHandler.remove();this.gentleFirstReceiptUnhoverEventHandler=null;return;}this._removeGentleFirstReceiptListeners();if(!this.gentleFirstReceiptRehoverEventHandler)this.gentleFirstReceiptRehoverEventHandler=Event.listen(this.obj,'mouseover',this.gentleFirstReceiptNotifRehover.bind(this));this._gentleFirstReceiptUIFadeAway();this._sendFirstReceiptYesToServer();},gentleFirstReceiptNotifRehover:function(event){if(this.clone_notif)CSS.hide(this.clone_notif);this.gentleFirstReceiptRehoverEventHandler.remove();},gentleFirstReceiptNoClick:function(event){this._removeGentleFirstReceiptListeners();},restore:function(){if(this.owner.notifXList.newNotifExist(this.id)){this.owner.notifXList.resumeInsert(this.id);}else this.owner.notifXList.removeNotif(this.id);this._confirmingMsgFadeAway(this.confirmingMsg);this._notifMainLinkShowUp(this.mainLink);this._buttonShowUp(this.xLink);this._adjustContainer(this.obj);},reset:function(){if(this.userXClicked&&!this.userUnsubscribed){this.userXClicked=false;this.restore();}},onTurnedOff:function(){this.userUnsubscribed=true;CSS.hide(this.confirmingMsg);this._notifMainLinkShowUp(DOM.find(this.obj,'.confirmedMsg'));this._adjustContainer(this.obj);},onUndid:function(){this.userXClicked=false;this.userUnsubscribed=false;this.restore();CSS.show(this.confirmingMsg);this._notifMainLinkFadeAway(DOM.find(this.obj,'.confirmedMsg'));DOM.remove(DOM.find(this.obj,'.confirmedMsg'));},onMarkedSpam:function(){DOM.remove(DOM.find(this.obj,'.confirmedMsg'));this._fadeAway(DOM.find(this.obj,'.spamMsg'));},onFirstReceiptYes:function(){this._hideFirstReceiptDiv();this._fadeAway(DOM.find(this.obj,'.firstConfirmedMsg'));},onFirstReceiptNo:function(){this._hideFirstReceiptDiv();CSS.hide(this.confirmingMsg);this._activateX();new AsyncRequest().setURI('/ajax/notifications/negative_req.php').setData({request_type:'turn_off',notification_id:this.id}).send();},_sendFirstReceiptYesToServer:function(){new AsyncRequest().setURI('/ajax/notifications/negative_req.php').setData({request_type:'first_receipt_yes',notification_id:this.id}).send();},_gentleFirstReceiptUIFadeAway:function(){DOM.prependContent(this.obj,this.clone_notif);CSS.removeClass(this.obj,'first_receipt');var a=this;animation(this.clone_notif).to('opacity','0').duration(this.FADE_AWAY_DURATION).ondone(function(){DOM.remove(a.clone_notif);}).go();},_removeGentleFirstReceiptListeners:function(){if(this.gentleFirstReceiptHoverEventHandler)this.gentleFirstReceiptHoverEventHandler.remove();if(this.gentleFirstReceiptUnhoverEventHandler)this.gentleFirstReceiptUnhoverEventHandler.remove();if(this.gentleFirstReceiptNoClickEventHandler)this.gentleFirstReceiptNoClickEventHandler.remove();},_activateX:function(){CSS.addClass(this.obj,'forPushSafety');this.userXClicked=true;this.owner.notifXList.userXClick(this.id);this._notifMainLinkFadeAway(this.mainLink);this._buttonFadeAway(this.xLink);if(CSS.shown(this.confirmingMsg))this._confirmingMsgShowUp(this.confirmingMsg);this._adjustContainer(this.obj);},_hideFirstReceiptDiv:function(){CSS.removeClass(this.obj,'first_receipt');CSS.hide(DOM.find(this.obj,'.first_receipt_div'));},_fadeAway:function(a){animation(a).from('backgroundColor','#FFF9D7').to('backgroundColor','#FFFFFF').duration(this.FADE_AWAY_DURATION).checkpoint().to('opacity','0').blind().duration(this.X_OUT_DURATION).checkpoint().to('height','0px').to('paddingTop','0px').to('paddingBottom','0px').blind().hide().duration(this.X_OUT_DURATION).go();},_adjustContainer:function(a){animation(a).by('height','0px').duration(this.X_OUT_DURATION).checkpoint().by('height','0px').duration(this.X_OUT_DURATION_SHORT).checkpoint().to('height','auto').duration(this.X_OUT_DURATION).go();},_notifMainLinkShowUp:function(a){animation(a).duration(this.X_OUT_DURATION).checkpoint().to('height','auto').to('paddingTop','4px').to('paddingBottom','4px').blind().show().duration(this.X_OUT_DURATION_SHORT).checkpoint().to('opacity','1').blind().duration(this.X_OUT_DURATION).go();},_confirmingMsgShowUp:function(a){animation(a).duration(this.X_OUT_DURATION).checkpoint().to('height','auto').to('paddingTop','10px').to('paddingBottom','10px').blind().show().duration(this.X_OUT_DURATION_SHORT).checkpoint().to('opacity','1').blind().duration(this.X_OUT_DURATION).go();},_notifMainLinkFadeAway:function(a){animation(a).to('opacity','0').blind().duration(this.X_OUT_DURATION).checkpoint().to('height','0px').to('paddingTop','0px').to('paddingBottom','0px').blind().hide().duration(this.X_OUT_DURATION_SHORT).go();},_confirmingMsgFadeAway:function(a){animation(a).to('opacity','0').blind().duration(this.X_OUT_DURATION).checkpoint().to('height','0px').to('paddingTop','0px').to('paddingBottom','0px').blind().duration(this.X_OUT_DURATION_SHORT).go();},_buttonShowUp:function(a){animation(a).duration(this.X_OUT_DURATION).checkpoint().show().duration(this.X_OUT_DURATION_SHORT).checkpoint().to('opacity','1').blind().duration(this.X_OUT_DURATION).go();},_buttonFadeAway:function(a){animation(a).to('opacity','0').blind().duration(this.X_OUT_DURATION).checkpoint().hide().duration(this.X_OUT_DURATION_SHORT).go();}});
__d("NotificationList",["Animation","Arbiter","ArbiterMixin","Class","CSS","DOM","DoublyLinkedListMap","HTML","URI","$","copyProperties","ge","isEmpty","tx","hasArrayNature"],function(a,b,c,d,e,f){var g=b('Animation'),h=b('Arbiter'),i=b('ArbiterMixin'),j=b('Class'),k=b('CSS'),l=b('DOM'),m=b('DoublyLinkedListMap'),n=b('HTML'),o=b('URI'),p=b('$'),q=b('copyProperties'),r=b('ge'),s=b('isEmpty'),t=b('tx'),u=b('hasArrayNature'),v="0",w="1",x="2";function y(ba){return ba==w||ba==x;}function z(ba){return ba==w;}function aa(ba,ca){this._list=new m();this._filter_func=null;this.unseenCount=0;this.contentRoot=ba;this.noItemsElement=null;this.ITEM_TAG='li';this.ITEM_CLASS='notification';this.NO_ITEMS_ID='jewelNoNotifications';this.NO_ITEMS_CLASS='empty';this.compare=ca.compare||this.compare;this.shouldBlockAnimation=ca.shouldBlockAnimation||null;this.unseenVsUnread=ca.unseenVsUnread||false;this.animations={};}q(aa,{ITEM_UNREAD_CLASS:'jewelItemNew',MARK_READ_TYPE:'mark_read',UNREAD_COUNT_CHANGE_TYPE:'unread_count_change',INSERTION_TYPE:'insert',REMOVAL_TYPE:'remove',getIdFromDom:function(ba){return ba.getAttribute('id').replace('notification_','');},localizeUrls:function(ba){l.scry(ba,'a').forEach(function(ca){o(ca.href).isFacebookURI()&&(ca.href=o(ca.href).getUnqualifiedURI().getQualifiedURI().setSubdomain(o(ca.href).getSubdomain()).toString());});}});q(aa.prototype,i,{FADE_DURATION:250,RESIZE_DURATION:200,_getField:function(ba,ca){var da=this._list.get(ba);return da&&da[ca];},getDomObj:function(ba){return this._getField(ba,'obj');},fromDom:function(){var ba=this.ITEM_TAG+'.'+this.ITEM_CLASS,ca=l.scry(this.contentRoot,ba);for(var da=0;da<ca.length;++da){var ea=ca[da],fa=aa.getIdFromDom(ea);this.insert(fa,ea.getAttribute('data-notiftime'),null);}},compare:function(ba,ca){return ba.time<ca.time||(ba.time===ca.time&&ba.id<ca.id);},insert:function(ba,ca,da,ea,fa,ga){var ha=w,ia=0,ja=this._list.exists(ba),ka=ga&&this._list.exists(ga),la=null,ma;if(ja||ka)if(!(ea&&da)){return false;}else{if(this._filter_func){ma={notif_id:ba,notif_time:ca,notif_markup:da,replace:ea,ignoreUnread:fa,notif_alt_id:ga};if(this._filter_func(ma))return false;}ha=this._getField(ba,'readness');ia=this._getField(ba,'time');if(ia>ca)return false;la=ja?ba:ga;this._remove(la);}var na=(da&&n(da).getRootNode())||p('notification_'+ba),oa=Math.max(ca,ia),pa=na.getAttribute('data-readness');if(!this.unseenVsUnread&&x==pa)pa=v;ma={id:ba,obj:na,time:oa,readness:pa,app_id:na.getAttribute('data-appid')};this._insert(ma);aa.localizeUrls(na);this.noItemsElement&&k.hide(this.noItemsElement);if(z(pa)){fa&&!y(ha)&&this.markRead([ba]);this.unseenCount=this.getUnseenIds().length;this.inform(aa.UNREAD_COUNT_CHANGE_TYPE);}var qa=!la||ia<oa||(pa&&!ha&&!fa);this.inform(aa.INSERTION_TYPE,{id:ba,is_new:qa,obj:na,replaced_id:la,time:oa});return true;},showNoNotifications:function(){if(null==this.noItemsElement)this.noItemsElement=r(this.NO_ITEMS_ID);if(null==this.noItemsElement){this.noItemsElement=l.create(this.ITEM_TAG,{id:this.NO_ITEMS_ID,className:this.NO_ITEMS_CLASS},"No hay notificaciones nuevas");l.appendContent(this.contentRoot,this.noItemsElement);}k.show(this.noItemsElement);},_insert:function(ba){this._list.remove(ba.id);var ca=null;this._list.find(function(ea){var fa=this.compare(ea,ba);!fa&&(ca=ea.id);return fa;}.bind(this));var da=this.getDomObj(ca);if(da){this._list.insertAfter(ba.id,ba,ca);l.insertAfter(da,ba.obj);}else{this._list.prepend(ba.id,ba);l.prependContent(this.contentRoot,ba.obj);}},_remove:function(ba){var ca=this._getField(ba,'obj');if(!ca)return false;this.inform(aa.REMOVAL_TYPE,{id:ba});this._list.remove(ba);l.remove(ca);this.isEmpty()&&this.showNoNotifications();return true;},getUnreadIds:function(){return this._list.reduce(function(ba,ca){y(ba.readness)&&ca.push(ba.id);return ca;},[]);},getUnseenIds:function(){return this._list.reduce(function(ba,ca){z(ba.readness)&&ca.push(ba.id);return ca;},[]);},getIds:function(){return this._list.reduce(function(ba,ca){ca.push(ba.id);return ca;},[]);},isUnreadId:function(ba){var ca=this.getDomObj(ba);return y(this._getField(ba,'readness'))||(ca&&k.hasClass(ca,aa.ITEM_UNREAD_CLASS));},isUnseenId:function(ba){return z(this._getField(ba,'readness'));},markRead:function(ba,ca){ba=ba?ba.filter(this.isUnreadId.bind(this)):this.getUnreadIds();var da=false;for(var ea=0;ea<ba.length;ea++){var fa=this._list.get(ba[ea]);if(fa){if(this._setReadness(ba[ea],v))da=true;if(ca){this._markReadInDom(ba[ea],fa.obj);}else this.animateMarkRead(fa.obj);}}if(da){this.unseenCount=this.getUnseenIds().length;this.inform(aa.UNREAD_COUNT_CHANGE_TYPE);}},markSeen:function(ba){if(!u(ba))return;if(!this.unseenVsUnread){this.markRead(ba);return;}ba=ba.filter(this.isUnseenId.bind(this));var ca=false;for(var da=0;da<ba.length;da++)if(this._setReadness(ba[da],x))ca=true;if(ca){this.unseenCount=this.getUnseenIds().length;this.inform(aa.UNREAD_COUNT_CHANGE_TYPE);}},_setReadness:function(ba,ca){var da=this._list.get(ba);if(!da||da.readness==ca)return false;if(da.readness==v&&ca==x)return false;da.readness=ca;da.obj.setAttribute('data-readness',ca);return true;},_markReadInDom:function(ba,ca){if(!this.isUnreadId(ba))return;var da=p(ca);if(da){this.stopAnimation(ba);k.removeClass(da,aa.ITEM_UNREAD_CLASS);}},animateMarkRead:function(ba){if(!k.hasClass(ba,aa.ITEM_UNREAD_CLASS))return;var ca=aa.getIdFromDom(ba),da=this._markReadInDom.bind(this,ca,ba);if(k.hasClass(ba,'fbJewelBeep')){da();return;}if(this.shouldBlockAnimation&&this.shouldBlockAnimation(ba))return;da.defer(10000);},stopAnimation:function(ba){ba in this.animations&&this.animations[ba].stop();delete this.animations[ba];return true;},insertMany:function(ba,ca){if('object'==typeof ba&&!s(ba)){for(var da in ba){var ea=ba[da];this.insert(da,ea.time,ea.markup,true,ca,ea.alt_id||null);}this.noItemsElement&&k.hide(this.noItemsElement);}else this.isEmpty()&&this.showNoNotifications();},isEmpty:function(){return this._list.isEmpty();},getEarliestNotifTime:function(){return this._list.isEmpty()?0:Math.min.apply(null,this.getIds().map(function(ba){return this._getField(ba,'time');}.bind(this)));},setFilterFn:function(ba){this._filter_func=ba;},toggleNotifsSimilarTo:function(ba,ca,da){var ea=this._getField(ba,'app_id');if(ea){var fa=this.getIds();for(var ga=0;ga<fa.length;++ga)if(ea==this._getField(fa[ga],'app_id')){var ha=this.getDomObj(fa[ga]);if(ba!=fa[ga])ca?this._hideWithAnimation(ha):this._showWithAnimation(ha);var ia=l.scry(ha,'.first_receipt_div');if(ia.length==1)if(da){k.hide(ia[0]);k.removeClass(ha,'first_receipt');}else{k.show(ia[0]);k.addClass(ha,'first_receipt');}}}},_hideWithAnimation:function(ba){g(ba).to('opacity','0').blind().duration(this.FADE_DURATION).checkpoint().to('height','0px').to('paddingTop','0px').to('paddingBottom','0px').blind().hide().duration(this.RESIZE_DURATION).go();},_showWithAnimation:function(ba){g(ba).to('height','auto').to('paddingTop','auto').to('paddingBottom','auto').blind().show().duration(this.RESIZE_DURATION).checkpoint().to('opacity','1').blind().duration(this.FADE_DURATION).go();}});e.exports=aa;});
__d("legacy:notifications-list",["NotificationList"],function(a,b,c,d){a.NotificationList=b('NotificationList');},3);
function Notifications(a){this.updateTime=a.updateTime||Date.now();this.update_period=a.updatePeriod||60000;this.latest_notif_time=a.latestNotif||0;this.latest_read_notif_time=a.latestReadNotif||0;this.cache_version=a.cacheVersion||0;this.notifReceivedType=a.notifReceivedType||'notification';this.wrapperID=a.wrapperID||'notificationsWrapper';this.contentID=a.contentID||'jewelNotifs';this.shouldLogImpressions=a.shouldLogImpressions||false;this.allowDesktopNotifications=a.allowDesktopNotifications||false;this.useInfiniteScroll=a.useInfiniteScroll||false;this.useUnaggregatedBeeper=a.unaggregatedBeeper||false;this.unseenVsUnread=a.unseenVsUnread||false;this.receiveSoundPath=a.receiveSoundPath||null;this.useAggregatedBottomBeeper=a.useAggregatedBottomBeeper||false;this.fadeInDuration=a.fadeInDuration||-1;this.fadeOutDuration=a.fadeOutDuration||-1;this.fadeOutDelay=a.fadeOutDelay||-1;this.scrollableAreaNode=null;this.firstReceiptMap={};this.user=Env.user;this.queuedNotifications=[];this.timeElement='small.time';this.ua=new UserNoOp();this._init();}Notifications.BEEPS_EXPIRED='beeper/beeps_expired';copyProperties(Notifications.prototype,{TIME_TRAVEL:'time_travel',ONLINE:'online',SCROLL_OFF_TINY:'scroll_off_tiny',INACTIVE_REFRESH:'inactive_refresh',_init:function(){this.BEEPER_APPID=30729425562;this.ignoreBeeps=false;this.cookieName='notifications_'+this.user;this.beepsExpiredToken=null;this.updateCheckCount=0;this.fetchListeners=[];this.currentFetchRequest=null;this.wrapper=ge(this.wrapperID);this.content=ge(this.contentID);this.jewelFlyout=ge('fbNotificationsFlyout');this.footer=DOM.find(this.jewelFlyout,'.jewelFooter');this.loadingIndicator=ge(this.contentID+'_loading_indicator');this.NOTIF_JEWEL_REF='notif_jewel';this.BEEPER_REF='beeper';this.notifLogger=JSLogger.create('notifications');NotificationCounter.init();this.alertList=new NotificationList(this.content,this._getListParams());this._updateCount();window.MinNotifications&&MinNotifications.fetchSent()&&(this.fetch=bagofholding);Arbiter.subscribe(ChannelConstants.getArbiterType(this.notifReceivedType),this._handleNotificationMsg.bind(this));Arbiter.subscribe(ChannelConstants.getArbiterType('notifications_read'),this._handleNotificationsReadMsg.bind(this));Arbiter.subscribe(ChannelConstants.getArbiterType('notifications_seen'),this._handleNotificationsSeenMsg.bind(this));Arbiter.subscribe('jewel/resize',this._hideOverflow.shield(this));this.alertList.subscribe(NotificationList.UNREAD_COUNT_CHANGE_TYPE,this._updateCount.bind(this));this._poller=new Poller(this.update_period,this._update.bind(this),true);if(this.wrapper)this.countSpan=DOM.find(this.wrapper,'span.jewelCount span');this.initializeEvents();this.fromDom();if(this.useInfiniteScroll){this._autoLoadNotifIndex=1;this._truncate=false;this.alertList.subscribe(NotificationList.INSERTION_TYPE,this._handleInsert.bind(this));}this._notifSound=null;},_getListParams:function(){return {shouldBlockAnimation:function(a){return this.isNotifJewelOpen();}.bind(this),unseenVsUnread:this.unseenVsUnread};},fromDom:function(){this.ignoreBeeps=true;this.alertList.fromDom();window.MinNotifications&&MinNotifications.fetched()&&this.alertList.isEmpty()&&this.alertList.showNoNotifications();this.ignoreBeeps=false;},initializeEvents:function(){var a=this.alertList.ITEM_TAG,b=null;Event.listen(this.content,{mouseover:function(event){var d=event.getTarget();b=Parent.byTag(d,a);if(b&&d!=b)if(Parent.byClass(b,'notifNegativeBase')){CSS.addClass(b,'notifHover');}else CSS.addClass(b,'selected');},mouseout:function(event){b&&CSS.removeClass(b,'selected');b&&CSS.removeClass(b,'notifHover');b=null;},mousedown:this.onContentMouseDown.bind(this)});Event.listen(this.wrapper,'mouseover',this.onMouseOver.bind(this));Toggler.listen('show',this.wrapper,this.onClick.bind(this));Toggler.listen('hide',this.wrapper,this.onHide.bind(this));this.shouldLogImpressions&&Toggler.listen('show',this.wrapper,this._logImpression.bind(this));var c=function(d){this._poller.requestNow();this.notifLogger.bump(d);}.bind(this);SystemEvents.subscribe(SystemEvents.TIME_TRAVEL,c.curry(this.TIME_TRAVEL));SystemEvents.subscribe(SystemEvents.ONLINE,function(d,e){e&&c(this.ONLINE);});INACTIVE_REFRESH_MS=1000*60*60;UserActivity.subscribe(function(d,e){(e.idleness>INACTIVE_REFRESH_MS)&&c(this.INACTIVE_REFRESH);}.bind(this));if(Parent.byClass(this.wrapper,'notifJewelBeeper')&&!FbDesktopPlugin.shouldSuppressBeeper()&&(this.beeper=window.NotifBeeper))this._initBeeper();this.negativeNotifs={};this._initNotifNegativeFeedback();if(this.useInfiniteScroll){this._setupScroll();this._initializeScrollEvents();this._updateScrollDataStructures.bind(this).defer();this._hideOverflow();}},_setupScroll:function(){this._scrollArea=DOM.scry(this.jewelFlyout,'div.uiScrollableAreaWrap')[0];this._morePagerLink=DOM.find(this.jewelFlyout,'.notifMorePager a');this._morePager=Parent.byClass(this._morePagerLink,'notifMorePager')||this._morePagerLink;this._infiniteScrollNotif=null;this.afterFirstFetch=false;this.animate=false;if(window.MinNotifications&&MinNotifications.fetched()){this.afterFirstFetch=true;CSS.show(this._morePager);}},_initializeScrollEvents:function(){Event.listen(this._scrollArea,'scroll',throttle(this._handleScroll.bind(this)));Event.listen(this._morePagerLink,'success',function(a){this.fetchHandler(a.getData().response);}.bind(this));},_updateScrollDataStructures:function(){var a=this.alertList.getIds(),b=Math.max(0,a.length-this._autoLoadNotifIndex);this._infiniteScrollNotif=this.alertList.getDomObj(a[b]);this._annotateMorePagerURI();},_annotateMorePagerURI:function(){this._morePagerLink.setAttribute('ajaxify',new URI(this._morePagerLink.getAttribute('ajaxify')).addQueryData({earliest_time:this.alertList.getEarliestNotifTime()}));},onContentMouseDown:function(event){var a=Parent.byTag(event.getTarget(),this.alertList.ITEM_TAG),b=a&&NotificationList.getIdFromDom(a);if(b&&this.alertList.isUnreadId(b))this.markRead(true,[b]);},onMouseOver:function(event){this.ua=user_action('jewel',event.target,event).set_namespace('notifs').set_ua_id('prefetch').add_event('hover');this.fetch();},onClick:function(){this.beeper&&this.beeper.clearBeeps();window.ArbiterMonitor&&this.fetch!=bagofholding&&Arbiter.registerCallback(bagofholding,['notifs/fetched']);this.ua.add_event('show');this.fetch();this.markRead(true);this._hideOverflow();if(this.scrollableAreaNode){var a=ScrollableArea.getInstance(this.scrollableAreaNode);a&&a.poke();}},onHide:function(){this.animate=false;this.animation&&this.animation.stop();this.ua.add_event('hide');this.markRead(true);this._dequeueNotifications();},_dequeueNotifications:function(){this.queuedNotifications.forEach(function(a){this._displayNotification(a.type,a.data);},this);this.queuedNotifications.length=0;},_handleScroll:function(){if(this._checkInfiniteScroll()){this._autoLoadNotifIndex=5;this._sendFetchRequest(this._morePager);}},_handleInsert:function(a,b){if(b.is_new)this._newDataFromInsert=true;this._updateScrollDataStructures();},_checkInfiniteScroll:function(){if(this._infiniteScrollNotif&&this._scrollArea){var a=Vector2.getElementPosition(this._infiniteScrollNotif).y,b=Vector2.getElementPosition(this._scrollArea).y+Vector2.getElementDimensions(this._scrollArea).y;return a<b;}return false;},_initBeeper:function(){this.beeper.init(this.jewelFlyout);this.beeper.setFadeInDuration(this.fadeInDuration);this.beeper.setFadeOutDuration(this.fadeOutDuration);this.beeper.setFadeOutDelay(this.fadeOutDelay);!this.useUnaggregatedBeeper&&this.alertList.subscribe(NotificationList.INSERTION_TYPE,function(a,b){if(!this.isNotifJewelOpen()&&!this.ignoreBeeps&&this.alertList.isUnreadId(b.id)){b.is_new?this.beeper.addBeep(b.id,b.obj):this.beeper.updateBeep(b.replaced_id,b.id,b.obj);this.logImpressionIds([b.id],this.BEEPER_REF);}}.bind(this));!this.useUnaggregatedBeeper&&this.alertList.subscribe(NotificationList.REMOVAL_TYPE,function(a,b){this.beeper.removeBeep(b.id);}.bind(this));this.useUnaggregatedBeeper&&new LiveMessageReceiver('unaggregated_beep').setAppId(this.BEEPER_APPID).setHandler(function(a){!this.isNotifJewelOpen()&&this.beeper.fromMessage(a);}.bind(this)).register();},_initNotifNegativeFeedback:function(){this.notifXList=null;this.notifXList=window.NotifXList;this.notifXList.init(this);this.alertList.setFilterFn(this.notifXList.filterStoreClicked);Toggler.listen('hide',$(this.wrapperID),function(){for(var a in this.negativeNotifs)if(a)this.negativeNotifs[a] instanceof NegativeNotif&&this.negativeNotifs[a].reset();}.bind(this));Arbiter.subscribe('notif/negativeCancel',function(a,b){this.negativeNotifs[b.id]&&this.negativeNotifs[b.id].restore();}.bind(this));Arbiter.subscribe('notif/negativeConfirmed',function(a,b){this.negativeNotifs[b.id]&&this.negativeNotifs[b.id].onTurnedOff();this.alertList.toggleNotifsSimilarTo(b.id,true,true);this._hideOverflow();this._handleScroll();}.bind(this));Arbiter.subscribe('notif/negativeUndid',function(a,b){this.negativeNotifs[b.id]&&this.negativeNotifs[b.id].onUndid();this.alertList.toggleNotifsSimilarTo(b.id,false,true);this._hideOverflow();}.bind(this));Arbiter.subscribe('notif/negativeMarkedSpam',function(a,b){this.negativeNotifs[b.id]&&this.negativeNotifs[b.id].onMarkedSpam();}.bind(this));Arbiter.subscribe('notif/negativeFirstReceiptYes',function(a,b){this.negativeNotifs[b.id]&&this.negativeNotifs[b.id].onFirstReceiptYes();this.alertList.toggleNotifsSimilarTo(b.id,false,true);}.bind(this));Arbiter.subscribe('notif/negativeFirstReceiptNo',function(a,b){this.negativeNotifs[b.id]&&this.negativeNotifs[b.id].onFirstReceiptNo();this.alertList.toggleNotifsSimilarTo(b.id,false,true);}.bind(this));this.alertList.subscribe(NotificationList.INSERTION_TYPE,function(a,b){this._updateFirstReceipt(b);var c=DOM.scry(b.obj,'.notif_x');if(c.length==1)this.negativeNotifs[b.id]=new NegativeNotif(this,b);}.bind(this));},_sendIDs:function(a,b,c){var d=c||{};for(var e=0;e<a.length;++e)d['alert_ids['+e+']']=a[e];new AsyncSignal(URI(b).getQualifiedURI().toString(),d).send();},_waitForFetch:function(a){return this.currentFetchRequest&&this.fetchListeners.push(a.bind(this));},_logImpression:function(){var a=this.alertList.getIds();if(a.length===0&&this._waitForFetch(this._logImpression))return;this.logImpressionIds(a,this.NOTIF_JEWEL_REF);},logImpressionIds:function(a,b){this.shouldLogImpressions&&this._sendIDs(a,'/ajax/notifications/impression.php',{ref:b});},markRead:function(a,b){var c=!hasArrayNature(b);b=c?this.alertList.getUnseenIds():b.filter(this.alertList.isUnreadId.bind(this.alertList));if(b.length){a&&this._sendIDs(b,'/ajax/notifications/mark_read.php',{seen:c?1:0});var d=a;c?this.alertList.markSeen(b):this.alertList.markRead(b,d);}c&&this._waitForFetch(this.markRead.bind(this,a));},markAllRead:function(){var a=this.alertList.getUnreadIds();this.markRead(true,a);},_updateErrorHandler:function(a){},_updateURI:'/ajax/presence/update.php',_update:function(a){a.setHandler(this._handleUpdate.bind(this)).setOption('suppressErrorAlerts',true).setErrorHandler(this._updateErrorHandler.bind(this)).setData({notif_latest:this.latest_notif_time,notif_latest_read:this.latest_read_notif_time}).setURI(this._updateURI).setAllowCrossPageTransition(true);},_handleUpdate:function(a){var b=a.payload.notifications;if(!b.no_change){this.updateTime=a.payload.time;this.latest_notif_time=b.latest_notif;this.latest_read_notif_time=b.latest_read_notif;this._updateDisplayDelayed();this.alertList.insertMany(b.notifications);}},_updateDisplayDelayed:function(){if(typeof Beeper!='undefined'){this.beepsExpiredToken=Arbiter.subscribe(Notifications.BEEPS_EXPIRED,this._updateDisplay.bind(this));}else this._updateDisplay();},_updateDisplay:function(){if(!this.content)return;this._updateCount();if(this.beepsExpiredToken)this.beepsExpiredToken.unsubscribe();},_updateCount:function(){Arbiter.inform('jewel/count-updated',{jewel:'notifications',count:this.alertList.unseenCount},Arbiter.BEHAVIOR_STATE);this._hideOverflow();},fetch:function(a){this._sendFetchRequest(a);},_getFetchQueryData:function(){var a={time:this.latest_notif_time,user:this.user,version:this.cache_version,locale:Env.locale};if(this.useInfiniteScroll)a.earliest_time=this.alertList.getEarliestNotifTime();return a;},_sendFetchRequest:function(a){if(this.useInfiniteScroll){this._infiniteScrollNotif=null;this._newDataFromInsert=false;this._truncate=true;}var b=URI('/ajax/notifications/get.php'),c=a||this.loadingIndicator;if(this.currentFetchRequest)return true;this.ua.add_event('fetch');b.setQueryData(this._getFetchQueryData());this.currentFetchRequest=new AsyncRequest().setURI(b).setStatusElement(c).setMethod('GET').setReadOnly(true).setTimeoutHandler(30000,this.fetchErrorHandler.bind(this)).setHandler(this.fetchHandler.bind(this)).setErrorHandler(this.fetchErrorHandler.bind(this)).setAllowCrossPageTransition(true);!this.currentFetchRequest.send()&&this.fetchErrorHandler();return true;},fetchErrorHandler:function(a){this.currentFetchRequest=null;this.ua.add_event('fetch_error');this.useInfiniteScroll&&this._updateScrollDataStructures();},fetchHandler:function(a){this.ua.add_event('fetch_success');var b=a.getPayload();this.alertList.insertMany(b.notifications,true);this.loadingIndicator&&CSS.hide(this.loadingIndicator);this.loadingIndicator=null;this.currentFetchRequest=null;this.fetch=bagofholding;if(this.fetchListeners){for(var c=0;c<this.fetchListeners.length;c++)this.fetchListeners[c]();this.fetchListeners=[];}window.ArbiterMonitor&&Arbiter.inform('notifs/fetched','',Arbiter.BEHAVIOR_STATE);var d=b.generated,e=Math.round((new Date()).getTime()/1000);if(e-d>15)d=e;Bootloader.loadComponents('live-timer',function(){LiveTimer.restart(d);LiveTimer.startLoop(0);});if(this.useInfiniteScroll){if(is_empty(b.notifications)||!this._newDataFromInsert){this._noMoreNotifications();}else CSS.show(this._morePager);this._updateScrollDataStructures();if(this.isNotifJewelOpen()&&this.afterFirstFetch)this.animate=true;this.afterFirstFetch=true;}this._hideOverflow();},_noMoreNotifications:function(){CSS.hide(this._morePager);this.useInfiniteScroll=false;},_mergeNotification:function(a,b,c,d){var e=!this.alertList.isUnreadId(a);this.alertList.insert(a,b,c,true,null,d||null);this.latest_notif_time=0;if(e)this._updateCount();var f=this.alertList.getDomObj(a);if(f)Bootloader.loadComponents('live-timer',function(){LiveTimer.addTimeStamps(f);});},_handleNotificationMsg:function(a,b){if(this.isNotifJewelOpen()){var c={type:a,data:b};this.queuedNotifications.push(c);}else this._displayNotification(a,b);},_displayNotification:function(a,b){var c=b.obj;if(typeof this.useDesktopNotifications=='undefined')this.useDesktopNotifications=this.allowDesktopNotifications&&window.webkitNotifications&&window.webkitNotifications.checkPermission()===0;if(this.useDesktopNotifications)Bootloader.loadComponents('desktop-notifications',function(){DesktopNotifications.addNotification(c.alert_id);});if(c.markup){this._mergeNotification(c.alert_id,c.time,c.markup,c.alt_id||null);requireLazy(['NotificationSound'],function(d){if(this._notifSound===null)this._notifSound=new d(this.receiveSoundPath);this._notifSound.play();}.bind(this));}else this._poller.requestNow();},_handleNotificationsReadMsg:function(a,b){var c=b.obj;if(typeof Beeper!='undefined')Beeper.getInstance().markRead(false,c.alert_ids);this.markRead(false,c.alert_ids);this.beeper&&this.beeper.fadeOutBeeps(b.obj.alert_ids);},_handleNotificationsSeenMsg:function(a,b){if(!this.unseenVsUnread){this._handleNotificationsReadMsg(a,b);return;}var c=b.obj;if(typeof Beeper!='undefined')Beeper.getInstance().markRead(false,c.alert_ids);this.alertList.markSeen(c.alert_ids);this.beeper&&this.beeper.fadeOutBeeps(b.obj.alert_ids);},_hideOverflow:function(){if(!this.isNotifJewelOpen())return;var a=DOM.scry($('fbNotificationsList'),'.notification');this.scrollableAreaNode=this.scrollableAreaNode||DOM.scry(this.jewelFlyout,'.uiScrollableArea')[0];var b=20,c=CSS.hasClass(document.documentElement,'tinyViewport')&&!CSS.hasClass(document.body,'fixedBody');if(!a.length||c){Style.set(this.scrollableAreaNode,'height','100%');this.notifLogger.rate(this.SCROLL_OFF_TINY,c);return;}var d=this.scrollableAreaNode||a[0],e=Vector2.getViewportDimensions().y-Vector2.getElementPosition(d,'viewport').y-Vector2.getElementDimensions(this.footer).y-5,f=e,g=0;for(;g<a.length&&f>0;++g)if(CSS.shown(a[g]))f-=Vector2.getElementDimensions(a[g]).y;var h=530,i=Math.min(h,e-Math.max(f,0));if(f>=0&&i<h){if(!this.useInfiniteScroll||(this.beeper&&this.beeper.hasBeeps())){i='100%';}else{if(this._truncate&&a.length>=5)i-=b;i+='px';}}else i+='px';if(this.useInfiniteScroll&&this.animate&&i!='100%'){this.animation&&this.animation.stop();this.animation=animation(this.scrollableAreaNode).to('height',i).duration(200).go();}else{var j=ScrollableArea.getInstance(this.scrollableAreaNode);j&&j.showScrollbar.bind(j).defer();Style.set(this.scrollableAreaNode,'height',i);}},_updateFirstReceipt:function(a){var b=a.obj.getAttribute('data-appid'),c=DOM.scry(a.obj,'.first_receipt_div');if(b&&c.length==1){if(this.firstReceiptMap[b]){if(a.id!=this.firstReceiptMap[b].id&&this.firstReceiptMap[b].time>a.time)return;CSS.removeClass(this.firstReceiptMap[b].obj,'first_receipt');}this.firstReceiptMap[b]=a;CSS.addClass(a.obj,'first_receipt');}},isNotifJewelOpen:function(){var a=Toggler.getInstance(this.wrapper).getActive();return (a===this.wrapper&&CSS.hasClass(a,'openToggler'));}});var OriginalNotifications=Notifications;
__d("legacy:notif-beeper",["NotifBeeper"],function(a,b,c,d){a.NotifBeeper=b('NotifBeeper');},3);
__d("PagesVoiceBar",["$","Arbiter","AsyncRequest","CSS","ChannelConstants","DOM","PageTransitions"],function(a,b,c,d,e,f){var g=b('$'),h=b('Arbiter'),i=b('AsyncRequest'),j=b('CSS'),k=b('ChannelConstants'),l=b('DOM'),m=b('PageTransitions'),n='PagesVoiceBar/toggle',o='PagesVoiceBar/initialized',p='PagesVoiceBar/switchVoice',q='page_transition',r='pages_voice_bar_sync',s=null,t=null,u=false,v=false;function w(){v=!v;j.conditionClass(document.body,'hasVoiceBar',v);}function x(da,ea){new i('/ajax/pages/switch_voice.php').setData(ea).setHandler(function(fa){ba();}).send();}function y(){s=null;}function z(da,ea){if(ea.obj.profile_id&&ea.obj.profile_id==s)ba();}function aa(da){h.subscribe(o,da);}function ba(){m.getNextURI().go();}var ca={initVoiceBar:function(){if(u)return;t=g('pagesVoiceBarContent');v=j.hasClass(document.body,'hasVoiceBar');h.subscribe(n,w);h.subscribe(p,x);h.subscribe(q,y);h.subscribe(k.getArbiterType(r),z);u=true;h.inform(o,null,h.BEHAVIOR_STATE);},update:function(da,ea){aa(function(){s=ea;l.setContent(t,da);});}};e.exports=ca;});
__d("TypeaheadSearchSponsored",["event-extensions","Arbiter","CSS","DOM","URI","copyProperties","tx"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('CSS'),i=b('DOM'),j=b('URI'),k=b('copyProperties'),l=b('tx');function m(n){this._typeahead=n;}m.auctionOptions={rerankingStrategy:4,neverRerankToTop1:true,minQueryLengthForTopResult:2,minBootstrapScoreForTopResult:0,maxNumberAds:3,maxNumberRemovedResults:2,maxNumberResultsAndAds:8,v1:10000,v2:0,debug:false,bootstrap:true};m.query=null;m.hasTopResult5=function(n,o,p){if(p.rerankingStrategy!=5)return false;if(n==null)return false;if(n.type=='user')return false;if((n.bootstrapped?p.v1:p.v2)<o)return false;return true;};m.hasTopResult4=function(n,o,p){if(p.rerankingStrategy!=4)return false;if(o==null)return false;if(o.length<p.minQueryLengthForTopResult)return false;if(n==null)return false;if(!n.bootstrapped)return false;if(n.index==null)return false;if(n.index>=p.minBootstrapScoreForTopResult)return false;if(n.type=='user')return false;return true;};m.getOriginalOrganics=function(n){return n.map(function(o){return {uid:o.uid,text:o.text,type:m.getRealType(o),source:o.bootstrapped?1:0,index:o.index};});};m.setDebugString=function(n,o){if(!m.auctionOptions.debug)return;n.debug_string=o;};m.setTopResult=function(n){n[0].renderTypeOverride=true;n[0].orig_render_type=n[0].render_type;n[0].render_type='tophit';};m.runAuction=function(n,o,p,q){n=n.slice(0,q.maxNumberResultsAndAds);if(n.length===0)return n;n=m.initResults(n);if(m.hasTopResult4(n[0],m.query,q))m.setTopResult(n);var r;if(!o){r=m.bucketResults(n);return r.results;}var s=m.prepareAndSortAds(n,o,p),t=m.selectAds(n,s,q);if(t.length===0){r=m.bucketResults(n);return r.results;}var u=t[0].s_value;if(m.hasTopResult5(n[0],u,q))m.setTopResult(n);var v=0;for(var w=0;w<t.length;++w)if(t[w].s_target!=t[w].uid)v++;n=n.slice(0,q.maxNumberResultsAndAds-v);var x=m.bucketResults(n),y=m.rerankAds(x.results,t,x.buckets,q);return y;};m.bucketResults=function(n){var o,p,q,r,s=[],t={};p=n.length;for(o=0;o<p;o++){q=n[o];r=q.render_type||q.type;if(!t.hasOwnProperty(r)){t[r]=s.length;s.push([]);}s[t[r]].push(q);}var u=[],v={};p=s.length;for(o=0;o<p;++o){q=s[o][0];r=q.render_type||q.type;v[r]=u.length;u=u.concat(s[o]);}return {results:u,buckets:v};};m.prepareAndSortAds=function(n,o,p){if(!o)return [];var q=[],r=n.length;for(var s=0;s<r;s++){var t=n[s];if(o[t.uid])for(var u in o[t.uid]){var v=o[t.uid][u];if(p&&p.hasOwnProperty(v.uid))continue;q.push(v);}}q.sort(function(w,x){return x.s_value-w.s_value;});return q;};m.selectAds=function(n,o,p){var q=Math.min(p.maxNumberAds,p.maxNumberRemovedResults+p.maxNumberResultsAndAds-n.length),r=[],s={},t=n.map(function(ca){return String(ca.uid);}),u={},v={},w=-1,x=false,y=0;for(var z=0;z<o.length;z++){if(r.length>=q){for(var aa=z;aa<o.length;aa++)m.setDebugString(o[aa],'filtered: '+q+' ads already selected');break;}while(y+t.length>=p.maxNumberResultsAndAds)w=t.pop();if(u.hasOwnProperty(w))x=true;var ba=o[z];if(x&&ba.s_target!=ba.uid){m.setDebugString(ba,'filtered: last organic '+w+' is targeted');continue;}if(ba.s_target!=ba.uid&&t.indexOf(String(ba.uid))!=-1){m.setDebugString(ba,'filtered: organic '+ba.uid+' targets another organic '+ba.s_target);continue;}if(s.hasOwnProperty(ba.s_account)){m.setDebugString(ba,'filtered: ad account '+ba.s_account+' already selected');continue;}if(v.hasOwnProperty(ba.uid)){m.setDebugString(ba,'filtered: ad promoted id '+ba.uid+' already selected');continue;}if(t.indexOf(String(ba.s_target))==-1)if(ba.s_target!=ba.uid||ba.s_target!=w){m.setDebugString(ba,'filtered: targeted organic '+ba.s_target+' will go away '+'promoted id '+ba.uid+' last organic '+w);continue;}m.setDebugString(ba,'selected');r.push(ba);s[ba.s_account]=true;u[ba.s_target]=true;v[ba.uid]=true;if(ba.s_target!=ba.uid)++y;}return r;};m.finalizeAd=function(n,o,p){var q="Patrocinado";n.rankType=n.rankType||n.render_type||n.type;if(n.s_target==n.uid){o.s_token=n.s_token;o.message=n.s_message;if(p.rerankingStrategy===0)o.subtextOverride=o.subtext?o.subtext+' \xB7 '+q:q;if(n.path){o.pathOverride=true;o.orig_path=o.path;o.path=n.path;}o.is_self=true;}else{n.message=n.s_message;n.subtextOverride=null;if(p.rerankingStrategy===0)n.subtextOverride=n.subtext?n.subtext+' \xB7 '+q:q;if(p.debug){if(!n.subtextOverride&&n.subtext)n.subtextOverride=n.subtext;if(n.subtextOverride){n.subtextOverride+=' \xB7 (Debug: '+o.text+')';}else n.subtextOverride='(Debug: '+o.text+')';}n.type=o.type;n.render_type=o.render_type;n.is_self=false;}};m.buildResultIndices=function(n){var o={},p=n.length;for(var q=0;q<p;q++)o[n[q].uid]=q;return o;};m.rerankMethod0=function(n,o,p,q){var r=m.buildResultIndices(n);for(var s=o.length-1;s>=0;s--){var t=o[s],u=r[t.s_target],v=n[u];m.finalizeAd(t,v,q);var w=false;if(t.uid==t.s_target){w=m.promoteSelfPromotedResult(n,u,p,q);}else{m.insertAdToTopOfSection(n,v,p,t,q);w=true;}if(w)r=m.buildResultIndices(n);}};m.promoteSelfPromotedResult=function(n,o,p,q){var r=n[o],s=r.render_type||r.type,t=p[s];if(q.neverRerankToTop1&&t===0)t=1;var u=false;if(o>t){n.splice(t,0,n.splice(o,1)[0]);u=true;}return u;};m.promoteSelfPromotedResultToTop=function(n,o,p,q){var r=n[o];if(o<p){var s="Patrocinado";r.subtextOverride=r.subtext?r.subtext+' \xB7 '+s:s;return;}if(o>p)n.splice(p,0,n.splice(o,1)[0]);r=n[p];r.renderTypeOverride=true;r.orig_render_type=r.render_type;r.render_type='ownsection';};m.insertAdToTopOfSection=function(n,o,p,q,r){var s=o.render_type||o.type,t=p[s];if(r.neverRerankToTop1&&t===0)t=1;n.splice(t,0,q);t=p[s];for(var u in p)if(p[u]>t)p[u]+=1;};m.insertAdToTop=function(n,o,p,q){n.splice(p,0,o);o.render_type='ownsection';};m.getTopAdPosition=function(n){if(n.length<1)return null;var o=n[0].render_type||n[0].type;if(o=='tophit')return 1;if(o=='user'){for(var p=1;p<n.length;++p){o=n[p].render_type||n[p].type;if(o!='user')return p;}return n.length;}return 0;};m.rerankMethod345=function(n,o,p){var q=0;if((p.rerankingStrategy==4)||(p.rerankingStrategy==5))q=m.getTopAdPosition(n);var r=m.buildResultIndices(n);for(var s=o.length-1;s>=0;s--){var t=o[s],u=r[t.s_target],v=n[u];m.finalizeAd(t,v,p);if(t.uid==t.s_target){m.promoteSelfPromotedResultToTop(n,u,q,p);}else m.insertAdToTop(n,t,q,p);r=m.buildResultIndices(n);}};m.rerankAds=function(n,o,p,q){switch(q.rerankingStrategy){case 0:m.rerankMethod0(n,o,p,q);break;case 3:case 4:case 5:m.rerankMethod345(n,o,q);break;default:break;}return n.slice(0,q.maxNumberResultsAndAds);};m.initResults=function(n){var o=n.length;for(var p=0;p<o;p++){var q=n[p];q.is_self=null;q.s_token=null;q.message=null;q.subtextOverride=null;if(q.pathOverride){q.path=q.orig_path;q.pathOverride=false;}if(q.renderTypeOverride){q.render_type=q.orig_render_type;q.renderTypeOverride=false;}q.rankType=q.rankType||q.render_type||q.type;}return n;};m.setAuctionOptions=function(n){k(m.auctionOptions,n);};m.getRealType=function(n){if(n.renderTypeOverride)return n.orig_render_type||n.type;return n.render_type||n.type;};m.hideAdResult=function(n,o){g.inform('TypeaheadSearchSponsored/hideAdResult',{uid:n,reason_dialog:o});};m.undoHideAdResult=function(n){g.inform('TypeaheadSearchSponsored/undoHideAdResult',{uid:n});};k(m.prototype,{_dataSubscriptions:null,_viewSubscriptions:null,_globalSubscriptions:null,_data:null,_view:null,_sponsoredEntries:null,_hiddenSponsoredEntities:null,_hideReasonDialog:null,_debugData:null,_sBootstrapID:null,enable:function(){this._data=this._typeahead.getData();this._dataSubscriptions=[this._data.subscribe('beginFetchHandler',function(n,o){var p=o.response.getPayload();if(p.s_entries){this._sponsoredEntries=this._sponsoredEntries||{};var q=p.s_entries.length;for(var r=0;r<q;r++){var s=p.s_entries[r],t=s.s_target;if(!this._sponsoredEntries[t])this._sponsoredEntries[t]={};this._sponsoredEntries[t][s.uid]=s;}if(p.s_bootstrap_id)this._sBootstrapID=p.s_bootstrap_id;}}.bind(this))];if(m.auctionOptions.bootstrap)this._dataSubscriptions.push(this._data.subscribe('onload',function(n,o){var p=k(this.bootstrapData,{no_cache:1,options:['sponsored']});this.fetch(this.bootstrapEndpoint,p,{type:'sponsored'});}.bind(this._data)));this._view=this._typeahead.getView();this._viewSubscriptions=[this._view.subscribe('finalResultsReordering',function(n,o){m.query=o.value;var p=m.getOriginalOrganics(o.results);m.setAuctionOptions({maxNumberResultsAndAds:this._data&&this._data._maxResults||8});var q=m.runAuction(o.results,this._sponsoredEntries,this._hiddenSponsoredEntities,m.auctionOptions),r=m.prepareAndSortAds(o.results,this._sponsoredEntries,this._hiddenSponsoredEntities),s=r.map(function(y){return y.s_token;}),t=[];for(var u=0;u<q.length;u++){var v=q[u];if(v.s_token)t.push({position:u,is_self:v.is_self});}this._view.inform('recordAfterReorder',{organic:p,tokens:s,position_data:t,s_bootstrap_id:this._sBootstrapID,options:m.auctionOptions,variant:m.auctionOptions.rerankingStrategy});if(m.auctionOptions.debug){var w=r.map(function(y){return {s_token:y.s_token,s_account:y.s_account,uid:y.uid,promoted_text:y.text||'SELF_PROMOTED',s_target:y.s_target,target_text:'PLACEHOLDER',s_value:y.s_value,debug_string:y.debug_string,source:y.bootstrapped?1:0};}),x=q.map(function(y){return {uid:y.uid,text:y.text,s_token:y.s_token,is_ad:y.s_token?'true':'false'};});this._debugData={options:m.auctionOptions,query:o.value,results:x,original_organic:p,ads_in_auction:w};}o.results=q;}.bind(this)),this._view.subscribe('highlight',function(n,o){if(this._view.content)i.scry(this._view.content,'a.report').forEach(h.hide);if(!o.element||!o.selected||!o.selected.s_token)return;var p=i.scry(o.element,'a.report');if(p.length){h.show(p[0]);}else i.appendContent(o.element,this._createHideAdLink(o.selected));}.bind(this))];if(m.auctionOptions.debug)this._viewSubscriptions.push(this._view.subscribe('render',function(n,o){var p=new j('/ads/debug/search_ads_debug.php').addQueryData(this._debugData).toString(),q={rel:'dialog-post',href:'#',ajaxify:p},r=i.create('div',{className:'debug'},[i.create('a',q,[i.create('span',{},['Click to debug'])])]);Event.listen(r,'mouseup',function(){this._view.index=-1;}.bind(this));i.appendContent(this._view.content,r);}.bind(this)));this._globalSubscriptions=[g.subscribe('TypeaheadSearchSponsored/hideAdResult',function(n,o){this._hiddenSponsoredEntities=this._hiddenSponsoredEntities||{};this._hiddenSponsoredEntities[o.uid]=true;this._hideReasonDialog=o.reason_dialog;this._forceRefreshResults();}.bind(this)),g.subscribe('TypeaheadSearchSponsored/undoHideAdResult',function(n,o){if(this._hiddenSponsoredEntities)delete this._hiddenSponsoredEntities[o.uid];if(this._hideReasonDialog){this._hideReasonDialog.hide();this._hideReasonDialog=null;}this._forceRefreshResults();}.bind(this))];},disable:function(){this._dataSubscriptions.forEach(this._data.unsubscribe.bind(this._data));this._dataSubscriptions=null;this._viewSubscriptions.forEach(this._view.unsubscribe.bind(this._view));this._viewSubscriptions=null;this._globalSubscriptions.forEach(g.unsubscribe.bind(g));this._globalSubscriptions=null;this._data=null;this._view=null;this._sponsoredEntries=null;},_forceRefreshResults:function(){if(this._data&&this._data.value)this._data.respond(this._data.value,this._data.buildUids(this._data.value));},_createHideAdLink:function(n){var o=new j('/ajax/emu/end.php').addQueryData({eid:n.s_token,f:0,ui:n.s_token,en:'fad_hide',ed:'true',a:1}).toString(),p={className:'report',rel:'dialog-post',href:'#',ajaxify:o,title:"Ocultar el anuncio"},q=i.create('a',p);Event.listen(q,'mouseover',function(event){this._view.index=-1;this._view.highlight(-1,false);event.kill();}.bind(this));return q;}});e.exports=m;});
__d("legacy:SearchSponsoredTypeaheadBehavior",["TypeaheadSearchSponsored"],function(a,b,c,d){var e=b('TypeaheadSearchSponsored');if(!a.TypeaheadBehaviors)a.TypeaheadBehaviors={};a.TypeaheadBehaviors.searchSponsored=function(f){f.enableBehavior(e);};},3);
__d("SearchDataSource",["event-extensions","Arbiter","AsyncResponse","Class","DataSource","copyProperties","createArrayFrom"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('AsyncResponse'),i=b('Class'),j=b('DataSource'),k=b('copyProperties'),l=b('createArrayFrom');function m(n){this._token=n.token||'';this._lazyonload=n.lazyonload===false?false:true;this._extraTypes=n.extraTypes;this._buckets=n.buckets;this._noMultiFetch=n.noMultiFetch||false;var o=n.maxResults||8;this.parent.construct(this,n);this._numResults={min:3,max:o};this._minWebSugg=n.minWebSugg||1;this._genTime=n.genTime;}i.extend(m,j);k(m.prototype,{init:function(){this.parent.init();this._leanPayload=null;this._bootstrapRequestsPending=0;this._criticalOnly=true;this._updateMaxResults();Event.listen(window,'resize',this._updateMaxResults.bind(this));},dirty:function(){this.parent.dirty();this._fetchOnUseRequests=[];},asyncErrorHandler:function(n){if(window.Dialog&&window.Dialog.getCurrent()==null&&n.getError()==1400003)h.verboseErrorHandler(n);},fetch:function(n,o,p){p=p||{};p.fetch_start=Date.now();this.parent.fetch(n,o,p);},fetchHandler:function(n,o){var p=n.getPayload(),q=k({fetch_end:Date.now()},o),r=q.value?g.BEHAVIOR_EVENT:g.BEHAVIOR_PERSISTENT;this.inform('beginFetchHandler',{response:n});if(o.type=='lean'){this._leanPayload=p;this._processLean();}else{if(p.coeff2_ts)q.coeff2_ts=p.coeff2_ts;this.parent.fetchHandler(n,o);if(o.bootstrap&&!n.getRequest().getData().no_cache)q.browserCacheHit=(p.timestamp<this._genTime);if(o.bootstrap&&!p.no_data&&this._bootstrapRequestsPending>0){o.bootstrap=false;--this._bootstrapRequestsPending;!this._bootstrapRequestsPending&&this._bootstrapPostProcess();}if(p.no_data||p.token!==this._token){var s=k({},n.getRequest().getData());if(s.lazy){delete s.lazy;s.token=this._token;this._fetchOnUse(s,o);}}}this.inform('endpointStats',q,r);},buildData:function(n){var o=[],p=[];for(var q=0;q<n.length;q++){var r=this.getEntry(n[q]);if(r.type==='websuggestion'){o.push(r);}else p.push(r);}if(p.length>=this._maxResults)return p.slice(0,this._maxResults);return p.concat(o.slice(0,Math.max(this._maxResults-p.length,this._minWebSugg)));},shouldFetchMoreResults:function(n){var o=0;n.forEach(function(p){if(p.type!=='websuggestion')o++;}.bind(this));return o<this._maxResults;},_bootstrapPostProcess:function(){var n={time:Date.now()};this.inform('bootstrapped',n,g.BEHAVIOR_PERSISTENT);this._processLean();},_processLean:function(){if(this._leanPayload){var n,o=this._leanPayload.entries;for(var p in o){n=this.getEntry(p);n&&(n.index=o[p]);}this.setExclusions(this._leanPayload.blocked);this._leanPayload=null;}},_updateMaxResults:function(){var n=window.innerHeight||document.documentElement.clientHeight;this.setMaxResults(Math.max(this._numResults.min,Math.min(this._numResults.max,Math.ceil(2+((n-370)/56)))));},_bootstrapFetch:function(n,o){var p=k(o,this.bootstrapData);if(this._criticalOnly&&this._lazyonload)p.lazy=1;this.fetch(this.bootstrapEndpoint,p,{bootstrap:true,type:n});++this._bootstrapRequestsPending;},_fetchOnUse:function(n,o){for(var p in this.bootstrapData)!n.hasOwnProperty(p)&&(n[p]=this.bootstrapData[p]);if(this._criticalOnly){this._fetchOnUseRequests.push({args:n,ctx:o});}else this.fetch(this.bootstrapEndpoint,n,o);},_fetchLean:function(){var n={no_cache:1};n.options=l(n.options);n.options.push('lean');this._fetchOnUse(n,{type:'lean'});},bootstrap:function(n){if(!n){this._criticalOnly=false;this._flushFetchOnUseRequests();}if(this._bootstrapped)return;var o={filter:['event'],no_cache:1};this._fetchOnUse(o,{type:'event'});var p=['app','page','group','friendlist'];p=p.concat(this._extraTypes||[]);if(this._noMultiFetch){p.push('user');this._bootstrapFetch('user',{filter:p});}else{this._bootstrapFetch('other',{filter:p});if(this._buckets){for(var q=0;q<this._buckets.length;++q){var r={filter:['user'],buckets:this._buckets[q]};this._bootstrapFetch('user',r);}}else this._bootstrapFetch('user',{filter:['user']});}this._fetchLean();this._bootstrapped=true;},_flushFetchOnUseRequests:function(){var n=this._fetchOnUseRequests.length;for(var o=0;o<n;++o){var p=this._fetchOnUseRequests[o];this.fetch(this.bootstrapEndpoint,p.args,p.ctx);}this._fetchOnUseRequests=[];},onLoad:function(n,o){this.inform('onload',{time:Date.now()},g.BEHAVIOR_PERSISTENT);if(n)this.bootstrap.bind(this,o).defer();},mergeUids:function(n,o,p,q){var r=p[0]?this.getEntry(p[0]):null,s=o[0]?this.getEntry(o[0]):null,t=(r&&r.replace_results)?r:null;t=(!t&&s&&s.replace_results)?s:t;var u=this.parent.mergeUids(n,o,p,q);if(t){this.inform('backend_topreplace',{});return this.deduplicateByKey([t.uid].concat(u));}return u;}});e.exports=m;});
__d("legacy:SearchDataSource",["SearchDataSource"],function(a,b,c,d){a.SearchDataSource=b('SearchDataSource');},3);
__d("SearchTypeaheadCore",["event-extensions","function-extensions","Arbiter","Class","DOM","Input","Parent","TypeaheadCore","URI","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');b('function-extensions');var g=b('Arbiter'),h=b('Class'),i=b('DOM'),j=b('Input'),k=b('Parent'),l=b('TypeaheadCore'),m=b('URI'),n=b('copyProperties');function o(p){this.parent.construct(this,p);}h.extend(o,l);n(o.prototype,{init:function(p,q,r){this.parent.init(p,q,r);var s=k.byTag(r,'form'),t=this.reset.bind(this);g.subscribe('pre_page_transition',function(event,v){var w=/^\/search/,x=w.test(v.from.path),y=w.test(v.to.path);if(x&&!y)t.defer();});if(s){var u=i.find(s,'input.search_sid_input');Event.listen(s,'submit',function(){if(this.data&&this.data.queryData)u.value=this.data.queryData.sid;t.defer();}.bind(this),Event.Priority.URGENT);}},select:function(){this.reset();this.element.focus();(function(){this.element.blur();}).bind(this).defer();},handleTab:function(event){var p=this.view.getQuerySuggestion(this.value);if(p){j.setValue(this.element,p);this.checkValue();event.kill();}else this.parent.handleTab(event);}});e.exports=o;});
__d("legacy:SearchTypeaheadCore",["SearchTypeaheadCore"],function(a,b,c,d){a.SearchTypeaheadCore=b('SearchTypeaheadCore');},3);
__d("SearchTypeaheadView",["Arbiter","ContextualTypeaheadView","Class","ContextualLayerUpdateOnScroll","copyProperties","DOM","goURI","MusicConstants","MusicEvents","tx","URI"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ContextualTypeaheadView'),i=b('Class'),j=b('ContextualLayerUpdateOnScroll'),k=b('copyProperties'),l=b('DOM'),m=b('goURI'),n=b('MusicConstants'),o=b('MusicEvents'),p=b('tx'),q=b('URI');function r(s,t){this.parent.construct(this,s,t);}i.extend(r,h);k(r.prototype,{initializeLayer:function(){this.parent.initializeLayer();this.layer.setOffsetY(-1);this.layer.enableBehavior(j);},ignoreClick:function(event){event.prevent();},shouldShowSeeMore:true,queryData:{init:'quick'},render:function(s,t,u){var v={results:t,value:s};this.inform('finalResultsReordering',v);return this.parent.render(s,v.results,u);},buildBuckets:function(s,t){var u=t.length;this.setWebSuggLoggingParams(s,t);t=this.parent.buildBuckets(s,t);if(s&&this.shouldShowSeeMore)t.push(this.buildSeeMore(s,u));return t;},buildSeeMore:function(s,t){var u=t>0?p._("Ver m\u00e1s resultados para {query}",{query:s}):p._("Ver resultados de {query}",{query:s}),v=t==1?"Se muestra el primer resultado":p._("Mostrando primeros {number} resultados",{number:t}),w=l.create('li',{className:'calltoaction'},[l.create('a',{href:this.getSeeMoreEndpoint(s),rel:'ignore'},[l.create('span',{className:'text'},[l.create('span',{className:'seeMore'},[u,l.create('span',{className:'arrow'})]),l.create('span',{className:'subtext'},[v])])])]);w.setAttribute('aria-label',u);return {uid:'search',node:w,search:true};},searchPageQueryData:function(s){return k({q:s},this.queryData||{});},select:function(s){var t=this.index,u=this.results[t];if(!u||u.type=='header')return;var v=this.items[t],w=l.scry(v,'a')[0];if(u.song){if(w)o.inform(n.MUSIC_BUTTON.ACTIVATE,w);s&&this.inform('highlight',{index:t,selected:u});}else{this.parent.select(s);if(w&&w.href)if(w.target=='_blank'){window.open(w.href);}else m(w.href);}},setSid:function(s){this.queryData.tas=s;},getSeeMoreEndpoint:function(s){return q(this.seeMoreEndpoint).addQueryData(this.searchPageQueryData(s)).toString();},show:function(){if(!this.isVisible()){g.inform('layer_shown',{type:'SearchTypeahead'});this.parent.show();}},hide:function(){if(this.isVisible()){g.inform('layer_hidden',{type:'SearchTypeahead'});this.parent.hide();}},getQuerySuggestion:function(s){var t=this.results[this.index],u=t&&t.type!='header'?t.text.toLowerCase():'';return u==s.toLowerCase()?'':u;},setWebSuggLoggingParams:function(s,t){var u=0,v=0;for(var w=0;w<t.length;w++)if(t[w].type==='websuggestion'){if(v===0)v=w+1;var x='FR'+(w-u)+'AS'+u,y=w+1;t[w].path+='&wssk='+x+'&wssp='+y+'&wspq='+encodeURIComponent(s);u++;}var z='&wssc='+t.length+'-'+s.length+'&wsbp='+u+'-'+v;for(w=0;w<t.length;w++)if(t[w].type==='websuggestion')t[w].path+=z;}});e.exports=r;});
__d("legacy:SearchTypeaheadView",["SearchTypeaheadView"],function(a,b,c,d){a.SearchTypeaheadView=b('SearchTypeaheadView');},3);
__d("legacy:Typeahead",["Typeahead"],function(a,b,c,d){a.Typeahead=b('Typeahead');},3);
__d("SearchTypeaheadRecorder",["event-extensions","AsyncRequest","Keys","$","copyProperties","userAction"],function(a,b,c,d,e,f){b('event-extensions');var g=b('AsyncRequest'),h=b('Keys'),i=b('$'),j=b('copyProperties'),k=b('userAction');function l(m){this.init(m);this.initEvents();}j(l.prototype,{_endPoint:'/ajax/typeahead/record_metrics.php',init:function(m){this.core=m.getCore();this.data=m.getData();this.view=m.getView();this.element=this.core.getElement();this.initTime=Date.now();this._onloadTime=0;this.initStartTime=i('search_first_focus').value;this.bootstrapStats={bootstrapped:0};this._reset();},_reset:function(){this.stats={};this.avgStats={};this.appendStats={};this._backspacing=false;this._topreplace=false;this._inflightRequests={};var m=Math.random();this.data.setQueryData({sid:m});this.view.setSid(m);this.recordStat('sid',m);},initEvents:function(){this.core.subscribe('focus',function(event){if(!this.stats.session_start_time)this.recordStat('session_start_time',Date.now());}.bind(this));this.core.subscribe('blur',function(event){var m=Date.now();for(var n in this._inflightRequests){var o=this._inflightRequests[n],p=m-o;this.recordAvgStat('search_endpoint_ms_from_js',p);}this.recordStat('session_end_time',m);this.submit();}.bind(this));this.view.subscribe('select',function(m,n){this.recordSelectInfo(n);}.bind(this));this.view.subscribe('render',function(m,n){this.recordRender(n);}.bind(this));this.view.subscribe('recordAfterReorder',function(m,n){this._reorderInfo=n;}.bind(this));this.data.subscribe('activity',function(m,n){this.recordStat('pending_request',n.activity);}.bind(this));this.data.subscribe('beforeQuery',function(m,n){if(!n.value)return;if(!this.stats.first_query_time)this.recordStat('first_query_time',Date.now());this.query=n.value;this.recordCountStat('num_queries');}.bind(this));this.data.subscribe('queryEndpoint',function(m,n){this.recordCountStat('num_search_ajax_requests');this.recordAvgStat('endpoint_query_length',n.value.length);this._inflightRequests[n.value]=Date.now();}.bind(this));this.data.subscribe('onload',function(m,n){this._onloadTime=n.time;}.bind(this));this.data.subscribe('bootstrapped',function(m,n){this.bootstrapStats.endTime=n.time;this.bootstrapStats.bootstrapped=1;}.bind(this));this.data.subscribe('endpointStats',function(m,n){var o=n.fetch_end-n.fetch_start;if(n.value){this.recordAvgStat('search_endpoint_ms_from_js',o);}else this.bootstrapStats[n.type]=o;if(n.coeff2_ts)this.bootstrapStats.coeff2_ts=n.coeff2_ts;if(typeof n.browserCacheHit!='undefined')this.recordCountStat(n.browserCacheHit?'bootstrap_cachehits':'bootstrap_cachemisses');if(this._inflightRequests[n.value])delete this._inflightRequests[n.value];}.bind(this));this.data.subscribe('query',function(m,n){this.recordAvgStat('num_results_from_cache',n.results.length);}.bind(this));this.data.subscribe('backend_topreplace',function(m,n){if(false===this._topreplace){this.recordStat("backend_topreplace",1);this._topreplace=true;}}.bind(this));Event.listen(this.element,'keydown',function(event){if(Event.getKeyCode(event)==h.BACKSPACE){if(!this._backspacing){this._backspacing=true;this.recordAppendStat('before_backspace_queries',this.query);}}else this._backspacing=false;}.bind(this));},recordStat:function(m,n){this.stats[m]=n;},recordCountStat:function(m){var n=this.stats[m];this.stats[m]=n?n+1:1;},recordAvgStat:function(m,n){if(this.avgStats[m]){this.avgStats[m][0]+=n;++this.avgStats[m][1];}else this.avgStats[m]=[n,1];},recordAppendStat:function(m,n){if(!this.appendStats.hasOwnProperty(m))this.appendStats[m]=[];this.appendStats[m].push(n);},recordRender:function(m){this.results=m.filter(function(n){return n.uid!='search'&&n.type!='header';});if(this.results.length>0&&!this.stats.first_result_time)this.recordStat('first_result_time',Date.now());},recordSelectInfo:function(m){var n=m.selected,o=m.index-n.groupIndex-1,p={href:n.path},q=n.dataGT?{gt:JSON.parse(n.dataGT)}:{};k('click',p,null,null,q);if(n.uid=='search'){this.recordStat('selected_search',1);}else{var r=n.rankType||n.render_type||n.type,s=(r=='friend'?'user':r);this.recordStat('selected_'+s,1);this.recordStat('selected_position',o);this.recordStat('selected_type',r);this.recordStat('selected_name_length',n.text.length);this.recordStat('selected_id',n.uid);this.recordStat('selected_degree',n.bootstrapped?1:2);}this.recordStat('selected_with_mouse',m.clicked?1:0);},_dataToSubmit:function(){this.recordStat('candidate_results',this.buildResults());this.recordStat('query',this.query);this.recordStat('init_time',this.initTime);if(this.initStartTime){this.recordStat('init_start_time',this.initStartTime);this.recordStat('onload_time',this._onloadTime);this.initStartTime=0;}this.recordStat('bootstrapped',this.bootstrapStats.bootstrapped);if(this.bootstrapStats.endTime){this.recordStat('bootstrapped_time',this.bootstrapStats.endTime);this.recordStat('user_bootstrap_ms',this.bootstrapStats.user);this.recordStat('other_bootstrap_ms',this.bootstrapStats.other);this.bootstrapStats.endTime=0;}this.recordStat('coeff2_ts',this.bootstrapStats.coeff2_ts);this.recordStat('max_results',this.data._maxResults);if(this._reorderInfo){var m=this._reorderInfo;m.organic.forEach(function(q){delete q.text;});this.recordStat('s_count',m.position_data.length);this.recordStat('s_bootstrap_id',m.s_bootstrap_id);this.recordStat('s_organic_results',JSON.stringify(m.organic));this.recordStat('s_candidate_tokens',JSON.stringify(m.tokens));this.recordStat('s_positions',JSON.stringify(m.position_data));this.recordStat('s_options',JSON.stringify(m.options));this.recordStat('s_variant',JSON.stringify(m.variant));}var n=this.stats;for(var o in this.avgStats){var m=this.avgStats[o];n[o]=m[0]/m[1];}for(var p in this.appendStats)n[p]=JSON.stringify(this.appendStats[p]);return n;},buildResults:function(){var m=(this.results||[]).map(function(n,o){var p=n.rankType||n.render_type||n.type,q=n.bootstrapped?1:0,r=n.s_token||'';if(typeof n.groupIndex=='number')return [n.groupIndex,n.indexInGroup,n.uid,p,q,r];return [0,o,n.uid,p,q,r];});return JSON.stringify(m);},submit:function(){var m=this._dataToSubmit();if(Object.keys(m).length>0)new g().setURI(this._endPoint).setMethod('POST').setData({stats:m}).setOption('handleErrorAfterUnload',true).setErrorHandler(function(n){m.retry=true;new g().setURI(this._endPoint).setMethod('POST').setData({stats:m}).setOption('asynchronous',false).send();}.bind(this)).send();this._reset();}});e.exports=l;});
__d("TypeaheadSearchRecorderBasic",["SearchTypeaheadRecorder","copyProperties"],function(a,b,c,d,e,f){var g=b('SearchTypeaheadRecorder'),h=b('copyProperties');function i(j){this._typeahead=j;}h(i.prototype,{enable:function(){new g(this._typeahead);},disable:bagofholding});e.exports=i;});
__d("legacy:SearchRecorderBasicTypeaheadBehavior",["TypeaheadSearchRecorderBasic"],function(a,b,c,d){var e=b('TypeaheadSearchRecorderBasic');if(!a.TypeaheadBehaviors)a.TypeaheadBehaviors={};a.TypeaheadBehaviors.searchRecorderBasic=function(f){f.enableBehavior(e);};},3);
__d("SearchTypeaheadRenderer",["DOM","Env","MusicButtonManager","TypeaheadUtil"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('Env'),i=b('MusicButtonManager'),j=b('TypeaheadUtil');function k(l,m){var n=[];if(l.photo){n.push(g.create('img',{className:'photo',alt:'',src:l.photo}));if(l.song){n.push(g.create('span',{className:'playButton'}));n.push(g.create('span',{className:'playLoader'}));}}if(l.text){var o=l.alias,p=this.value,q=l.text,r=[q];if(o&&j.isQueryMatch(p,o)&&!j.isQueryMatch(p,q))r.push(g.create('span',{className:'alias'},[' \xB7 '+o]));n.push(g.create('span',{className:'text'},r));}if(l.category){var s=[l.category];if(l.is_external)s.push(g.create('span',{className:'arrow'}));var t=l.message?'preCategory':'category';n.push(g.create('span',{className:t},s));}if(l.message)n.push(g.create('span',{className:'category'},[l.message]));var u=l.subtextOverride||l.subtext;if(u)n.push(g.create('span',{className:'subtext'},[u]));var v=l.classNames||l.type||'',w=l.is_external?'_blank':'',x=!l.song&&l.path||'';if(x){if(!(/^https?\:\/\//).test(x))x=h.www_base+x.substr(1);x+=(x.indexOf('?')>0?'&':'?')+'ref=ts';}var y=g.create('a',{href:x,rel:'ignore',target:w},n);if(l.song){y.id='mb_'+(Math.random()*1e+06|0);i.addButton.curry(l.song.provider,y.id,l.song.url,l.song.context,l.song.media_type).defer();y.onclick=this.ignoreClick;}var z=g.create('li',{className:v},[y]);z.setAttribute('role','option');if(l.text)z.setAttribute('aria-label',l.text);return z;}k.className='search';e.exports=k;});
__d("legacy:SearchTypeaheadRenderer",["SearchTypeaheadRenderer"],function(a,b,c,d){if(!a.TypeaheadRenderers)a.TypeaheadRenderers={};a.TypeaheadRenderers.search=b('SearchTypeaheadRenderer');},3);
void(0);
__d("TypeaheadSearchFilter",["Arbiter","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('copyProperties');function i(j){this._typeahead=j;}h(i.prototype,{_subscription:null,enable:function(){var j=this._typeahead;this._subscriptions=[g.subscribe('search/typeahead/updateFilter',function(k,l){if(l.filter_type=='web')j.getView().queryData.form='FBKBFR';j.getView().queryData.type=l.filter_type;}),g.subscribe('page_transition',function(k,l){if(j.getView().queryData.form)delete j.getView().queryData.form;delete j.getView().queryData.type;},g.SUBSCRIBE_NEW)];},disable:function(){this._subscriptions.forEach(function(j){j.unsubscribe();});this._subscriptions=null;}});e.exports=i;});
__d("legacy:SearchFilterTypeaheadBehavior",["TypeaheadSearchFilter"],function(a,b,c,d){var e=b('TypeaheadSearchFilter');if(!a.TypeaheadBehaviors)a.TypeaheadBehaviors={};a.TypeaheadBehaviors.initFilters=function(f){f.enableBehavior(e);};},3);
__d("TypeaheadRegulateMemorializedUsers",["copyProperties","TypeaheadUtil"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=b('TypeaheadUtil');function i(j){this._typeahead=j;}g(i.prototype,{_filterRegistry:null,_filter:function(j,k){if(j.type!=='user'||!j.memorialized)return true;var l=h.parse(j.text).tokens;if(l.length===1&&h.isExactMatch(k,j.text))return true;var m=this._typeahead.getData().getTextToIndex(j),n=h.parse(k).tokens;return (n.length>1&&h.isQueryMatch(k,m));},enable:function(){this._filterRegistry=this._typeahead.getData().addFilter(this._filter.bind(this));},disable:function(){this._filterRegistry.remove();this._filterRegistry=null;}});e.exports=i;});
__d("legacy:RegulateMemorializedUsersTypeaheadBehavior",["TypeaheadRegulateMemorializedUsers"],function(a,b,c,d){var e=b('TypeaheadRegulateMemorializedUsers');if(!a.TypeaheadBehaviors)a.TypeaheadBehaviors={};a.TypeaheadBehaviors.regulateMemorializedUsers=function(f){f.enableBehavior(e);};},3);
__d("WebStorageMonster",["event-extensions","AsyncRequest","UserActivity","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f){b('event-extensions');var g=b('AsyncRequest'),h=b('UserActivity'),i=b('setTimeoutAcrossTransitions'),j=300000,k=false;function l(q){var r={};for(var s in q){var t=q.getItem(s);if(typeof t==='string')r[s]=t.length;}return r;}function m(q){if(a.localStorage)p._getLocalStorageKeys().forEach(function(r){if(!q.contains(r))a.localStorage.removeItem(r);});}function n(q){if(a.localStorage)p._getLocalStorageKeys().forEach(function(r){if(!q.some(function(s){return new RegExp(s).test(r);}))a.localStorage.removeItem(r);});if(a.sessionStorage)a.sessionStorage.clear();}function o(q){if(h.isActive(j)){i(o.curry(q),j);}else p.cleanNow(q);}var p={registerLogoutForm:function(q,r){Event.listen(q,'submit',function(s){p.cleanOnLogout(r);});},schedule:function(q){if(k)return;k=true;o(q);},cleanNow:function(q){var r=Date.now(),s={},t=false;['localStorage','sessionStorage'].forEach(function(v){if(a[v]){s[v]=l(a[v]);t=true;}});var u=Date.now();s.logtime=u-r;if(t)new g('/ajax/webstorage/process_keys.php').setData(s).setHandler(function(v){if(!q)m(v.getPayload());}.bind(this)).send();},cleanOnLogout:function(q){if(q)n(q);if(a.sessionStorage)a.sessionStorage.clear();},_getLocalStorageKeys:Object.keys.curry(a.localStorage)};e.exports=p;});