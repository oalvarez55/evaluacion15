/*1343141045,169776320*/

if (window.CavalryLogger) { CavalryLogger.start_js(["Cbo45"]); }

WindowComm={_callbacks:{},makeHandler:function(a,b){b=b||'opener';var c='f'+(Math.random()*(1<<30)).toString(16).replace('.','');WindowComm._callbacks[c]=a;return new URI('/connect/window_comm.php').setQueryData({_id:c,_relation:b}).getQualifiedURI().toString();},_recv:function(a){var b=new URI(a).getQueryData();WindowComm._callbacks[b._id](b);}};
__d("legacy:async",["AsyncRequest","AsyncResponse"],function(a,b,c,d){a.AsyncRequest=b('AsyncRequest');a.AsyncResponse=b('AsyncResponse');},3);
ConnectLogin={init:function(a){this.appID=a.appID;this.addToProfile=a.addToProfile;this.oneClick=a.oneClick;this.channelUrl=a.channelUrl;XD.init(a);},login:function(a,b,c){if(this.oneClick&&!b){this._oneClick(a);}else this._openPopup(a,b,c);},logout:function(){XD.send({type:'logout'});},_oneClick:function(a){new AsyncRequest().setURI('/ajax/api/tos.php').setData({app_id:this.appID,grant_perm:1}).setHandler(function(b){ConnectLogin._refreshLoginStatus();a&&a();}).send();},_openPopup:function(a,b,c){c=c||{};var d=WindowComm.makeHandler(function(h){ConnectLogin._closePopup();if(ConnectLogin.appID)ConnectLogin._refreshLoginStatus();a&&a();}),e=WindowComm.makeHandler(function(h){ConnectLogin._closePopup();}),f=new URI('/login.php');f.setQueryData({api_key:this.appID,next:d,channel_url:e,cancel_url:e,req_perms:b,v:'1.0',fbconnect:1,add_to_profile:this.addToProfile,display:'popup'});f.addQueryData(c);var g=this._getSize(c);this._popup=PopupResizer.open(f.toString(),g.height,g.width);},_closePopup:function(){if(this._popup){this._popup.close();this._popup=null;}},_refreshLoginStatus:function(){if(this.channelUrl){XD.send({type:'refreshLoginStatus'});}else window.location.reload();},_getSize:function(a){if(a.social_plugin=='registration'){return {width:640,height:370};}else return {width:610,height:280};}};
__d("OnloadHooks",["Arbiter","ErrorUtils","InitialJSLoader","OnloadEvent"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ErrorUtils'),i=b('InitialJSLoader'),j=b('OnloadEvent');function k(){var r=a.CavalryLogger;if(!window.loaded&&r)r.getInstance().setTimeStamp('t_prehooks');n('onloadhooks');if(!window.loaded&&r)r.getInstance().setTimeStamp('t_hooks');window.loaded=true;g.inform('uipage_onload',true,g.BEHAVIOR_STATE);}function l(){n('onafterloadhooks');window.afterloaded=true;}function m(r,s){return h.applyWithGuard(r,null,null,function(t){t.event_type=s;t.category='runhook';});}function n(r){var s=(r=='onbeforeleavehooks')||(r=='onbeforeunloadhooks');do{var t=window[r];if(!t)break;if(!s)window[r]=null;for(var u=0;u<t.length;u++){var v=m(t[u],r);if(s&&v)return v;}}while(!s&&window[r]);}function o(){if(!window.loaded){window.loaded=true;n('onloadhooks');}if(!window.afterloaded){window.afterloaded=true;n('onafterloadhooks');}}function p(){g.registerCallback(k,[j.ONLOAD_DOMCONTENT_CALLBACK,i.INITIAL_JS_READY]);g.registerCallback(l,[j.ONLOAD_DOMCONTENT_CALLBACK,j.ONLOAD_CALLBACK,i.INITIAL_JS_READY]);g.subscribe(j.ONBEFOREUNLOAD,function(r,s){s.warn=n('onbeforeleavehooks')||n('onbeforeunloadhooks');if(!s.warn){window.loaded=false;window.afterloaded=false;}},g.SUBSCRIBE_NEW);g.subscribe(j.ONUNLOAD,function(r,s){n('onunloadhooks');},g.SUBSCRIBE_NEW);}var q={_onloadHook:k,_onafterloadHook:l,runHook:m,runHooks:n,keepWindowSetAsLoaded:o};p();a.OnloadHooks=e.exports=q;});
__d("legacy:onload-action",["OnloadHooks"],function(a,b,c,d){var e=b('OnloadHooks');a._onloadHook=e._onloadHook;a._onafterloadHook=e._onafterloadHook;a.runHook=e.runHook;a.runHooks=e.runHooks;a.keep_window_set_as_loaded=e.keepWindowSetAsLoaded;},3);
function SendButton(a){var b=$(a.divID);copyProperties(this,{button:DOM.find(b,'a.btnLink'),channel:a.channel,div:b,divID:a.divID,loggedIn:!!a.userID,nodeImageURL:a.nodeImageURL,nodeTitle:a.nodeTitle,nodeURL:a.nodeURL,nodeSummary:a.nodeSummary,error:a.error,initFormOpen:a.initFormOpen,extended_social_context:a.extended_social_context,likeButtonLayout:a.likeButtonLayout});this.init();}copyProperties(SendButton.prototype,{init:function(){this.formIsOpen=false;this.formIsShown=false;this.pendingFormShow=false;Arbiter.subscribe('platform/socialplugins/send/sent',function(a,b){if(b.controllerID===this.divID)this.closeForm();}.bind(this),Arbiter.SUBSCRIBE_NEW);Arbiter.subscribe('platform/socialplugins/send/cancel',function(a,b){if(b.controllerID===this.divID)this.hideForm();}.bind(this),Arbiter.SUBSCRIBE_NEW);this.buttonWidth=Vector2.getElementDimensions(this.button).x;this.widthSyncArbiter=Arbiter.subscribe('platform/socialplugins/like/resize',this.syncLikeWidgetWidth.bind(this));Arbiter.inform('platform/socialplugins/send/resize',{button_width:this.buttonWidth},Arbiter.BEHAVIOR_STATE);Arbiter.subscribe('platform/socialplugins/dialog',function(a,b){if(b.controllerID!==this.divID&&b.event=='open')this.closeForm();}.bind(this));UnverifiedXD.init({channelUrl:this.channel,autoResize:true,resizeWidth:true});Event.listen(this.button,'click',this.toggleFormVisibility.bind(this));if(this.initFormOpen)onafterloadRegister_DEPRECATED(this.toggleFormVisibility.bind(this));},syncLikeWidgetWidth:function(a,b){var c=b.button_width-this.buttonWidth;if(b.layout==='box_count'&&c>0&&c<=5)Style.set(this.div,'width',(b.button_width-parseInt(Style.get(this.button,'paddingLeft'))-parseInt(Style.get(this.button,'paddingRight'))-parseInt(Style.get(this.button,'borderLeftWidth'))-parseInt(Style.get(this.button,'borderRightWidth')))+'px');if(b.layout==='standard'){var d=intl_locale_is_rtl()?'right':'left';Style.set(this.div,'position','absolute');Style.set(this.div,d,(b.button_width+5)+'px');this.invertedButtons=true;}this.likeWidgetWidth=b.widget_width;this.likeButtonWidth=b.button_width;},toggleFormVisibility:function(a){if(!this.loggedIn){a.kill();PlatformOptInPopup.open('send');return;}if(!this.formIsOpen){this.openForm();}else if(this.formIsShown){this.hideForm();}else this.showForm();a.prevent();},hideForm:function(){if(this.formIsShown){this.formIsShown=false;UnverifiedXD.send({type:'hideEdgeCommentDialog'});CSS.removeClass(this.div,'fbSendButtonSelected');}},showForm:function(){if(!this.formIsShown){CSS.addClass(this.div,'fbSendButtonSelected');this.formIsShown=true;UnverifiedXD.send({type:'showEdgeCommentDialog'});}},closeForm:function(){Arbiter.inform('platform/socialplugins/dialog',{controllerID:this.divID,event:'close'});if(this.formIsOpen){this.formIsOpen=this.formIsShown=false;UnverifiedXD.send({type:'dismissEdgeCommentDialog'});CSS.removeClass(this.div,'fbSendButtonSelected');}return this;},openForm:function(){Arbiter.inform('platform/socialplugins/dialog',{controllerID:this.divID,event:'open'});if(!this.formIsOpen){CSS.addClass(this.div,'fbSendButtonSelected');this.formIsOpen=this.formIsShown=true;var a={type:'presentEdgeCommentDialog',nodeImageURL:this.nodeImageURL,nodeTitle:this.nodeTitle,nodeURL:this.nodeURL,nodeSummary:this.nodeSummary,controllerID:this.divID,error:this.error,widget_type:'send',extended_social_context:this.extended_social_context,width:400,height:300},b=Vector2.getElementDimensions(this.button),c=Vector2.getElementPosition(this.button);a.anchorGeometry={x:b.x,y:b.y};a.anchorPosition={x:c.x,y:c.y};var d=DOM.find(this.button,'.msgIcon'),e=Vector2.getElementPosition(d),f=Vector2.getElementDimensions(d);a.query={anchorTargetX:e.x+f.x/2,anchorTargetY:e.y+f.y/2};UnverifiedXD.send(a);}return this;}});